<!doctype html>
<html lang="ko" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AITRICS 2026 Dr.Answer 3.0 | Master Roadmap</title>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&family=Pretendard:wght@400;600;800&display=swap");

      /* =========================================================
       VISIBILITY REVISION (ê°€ì‹œì„± ê°œì„ )
       - íƒ€ì´í¬/ê°„ê²©/ëŒ€ë¹„ ê°œì„ 
       - í…Œì´ë¸” í—¤ë” sticky + ì¢Œì¸¡ ì»¬ëŸ¼ sticky
       - ì¤„ë¬´ëŠ¬(zebra) + Hover ê°•ì¡°
       - DUE ì„ë°•/ì§€ì—° ìƒ‰ìƒ ê°•ì¡°
       - ë¼ì´íŠ¸/ë‹¤í¬ + ë°€ë„(Comfort/Compact) í† ê¸€
    ========================================================= */

      :root {
        /* Dark */
        --bg: #05070c;
        --surface: #0b0f18;
        --surface2: #0f1522;
        --border: #1f2a3a;
        --border2: rgba(255, 255, 255, 0.08);

        --text-p: #f8fafc;
        --text-s: #a7b2c4;

        --data: #00d1ff;
        --ai: #a855f7;
        --svc: #f43f5e;
        --reg: #fbbf24;

        --done: #10b981;
        --danger: #fb7185;

        --radius: 18px;

        --shadow: 0 14px 40px rgba(0, 0, 0, 0.45);

        --fs-12: 12px;
        --fs-13: 13px;
        --fs-14: 14px;
        --fs-16: 16px;

        --lh: 1.55;
        --mono:
          "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
          Consolas, "Liberation Mono", "Courier New", monospace;
        --sans:
          "Pretendard", system-ui, -apple-system, Segoe UI, Roboto,
          "Noto Sans KR", sans-serif;
      }

      html[data-theme="dark"] {
        color-scheme: dark;
      }
      html[data-theme="light"] {
        color-scheme: light;
        --bg: #f6f7fb;
        --surface: #ffffff;
        --surface2: #f2f4f8;
        --border: #d6deea;
        --border2: rgba(15, 23, 42, 0.12);

        --text-p: #0b1220;
        --text-s: #4b5563;

        --shadow: 0 14px 40px rgba(2, 6, 23, 0.1);
      }

      * {
        box-sizing: border-box;
      }
      body {
        font-family: var(--sans);
        background: var(--bg);
        color: var(--text-p);
        margin: 0;
        padding: 28px;
        line-height: var(--lh);
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
      }

      :focus-visible {
        outline: 2px solid rgba(0, 209, 255, 0.55);
        outline-offset: 2px;
        border-radius: 10px;
      }

      .container {
        max-width: 1780px;
        margin: 0 auto;
      }
      header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        gap: 14px;
        margin-bottom: 14px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 14px;
      }
      .h-title {
        margin: 0;
        font-size: 22px;
        letter-spacing: 0.2px;
        line-height: 1.25;
      }
      .h-sub {
        margin: 6px 0 0 0;
        color: var(--text-s);
        font-size: var(--fs-13);
      }
      .right-stack {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 10px;
        min-width: 260px;
      }
      .total-stat {
        text-align: right;
      }
      .total-label {
        font-size: var(--fs-12);
        color: var(--text-s);
        font-weight: 900;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: flex-end;
      }
      .total-percent {
        font-family: var(--mono);
        font-size: 42px;
        font-weight: 800;
        color: var(--data);
        letter-spacing: -0.5px;
      }

      .top-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .btn {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text-p);
        border-radius: 12px;
        padding: 9px 12px;
        font-size: var(--fs-12);
        font-weight: 900;
        cursor: pointer;
        box-shadow: none;
        transition:
          transform 0.08s ease,
          background 0.12s ease,
          border-color 0.12s ease;
      }
      html[data-theme="light"] .btn {
        background: rgba(15, 23, 42, 0.03);
      }
      .btn:hover {
        background: rgba(255, 255, 255, 0.06);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn.primary {
        border-color: rgba(0, 209, 255, 0.32);
      }
      .btn.danger {
        border-color: rgba(251, 113, 133, 0.4);
      }
      .btn.ghost {
        background: transparent;
      }
      .btn.small {
        padding: 8px 10px;
        border-radius: 10px;
      }
      .badge {
        font-family: var(--mono);
        font-size: 10px;
        font-weight: 900;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border2);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text-s);
        white-space: nowrap;
      }
      html[data-theme="light"] .badge {
        background: rgba(15, 23, 42, 0.03);
      }
      .badge.on {
        color: #001b12;
        background: rgba(16, 185, 129, 0.14);
        border-color: rgba(16, 185, 129, 0.38);
      }

      /* Anchor Nav (ì„¹ì…˜ ì´ë™ìš©) */
      .nav {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 12px 0 16px 0;
      }
      .nav a {
        text-decoration: none;
        color: var(--text-p);
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.03);
        padding: 9px 12px;
        border-radius: 12px;
        font-size: var(--fs-12);
        font-weight: 900;
        transition: background 0.12s ease;
      }
      html[data-theme="light"] .nav a {
        background: rgba(15, 23, 42, 0.03);
      }
      .nav a:hover {
        background: rgba(255, 255, 255, 0.06);
      }

      .section-title {
        font-size: var(--fs-13);
        font-weight: 900;
        color: var(--text-s);
        margin: 18px 0 10px 0;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        margin-bottom: 14px;
        box-shadow: var(--shadow);
      }
      html[data-theme="light"] .card {
        box-shadow: var(--shadow);
      }

      .note {
        font-size: var(--fs-12);
        color: var(--text-s);
        line-height: 1.55;
      }

      /* ===== 4 Category Progress Overview ===== */
      .grid-4 {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
      }
      .p-card {
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 14px;
      }
      .p-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }
      .p-name {
        font-size: var(--fs-13);
        font-weight: 900;
      }
      .p-meta {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--text-s);
        text-align: right;
        white-space: nowrap;
      }
      .p-bar {
        margin-top: 12px;
        height: 12px;
        border-radius: 999px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.07);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      html[data-theme="light"] .p-bar {
        background: rgba(15, 23, 42, 0.06);
        border-color: rgba(15, 23, 42, 0.08);
      }
      .p-fill {
        height: 100%;
      }
      .p-foot {
        margin-top: 12px;
        display: flex;
        justify-content: space-between;
        gap: 10px;
        align-items: center;
      }
      .pill {
        font-family: var(--mono);
        font-size: 10px;
        font-weight: 900;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border2);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text-s);
        white-space: nowrap;
      }
      html[data-theme="light"] .pill {
        background: rgba(15, 23, 42, 0.03);
      }

      @media (max-width: 1200px) {
        .grid-4 {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 760px) {
        .grid-4 {
          grid-template-columns: 1fr;
        }
        body {
          padding: 16px;
        }
        header {
          align-items: flex-start;
        }
        .right-stack {
          align-items: flex-start;
        }
        .total-stat {
          text-align: left;
        }
        .total-label {
          justify-content: flex-start;
        }
      }

      /* ===== Timeline ===== */
      .timeline-card {
        overflow-x: auto;
      }
      .gantt-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 980px;
      }
      .gantt-table th {
        padding: 10px 10px;
        font-size: 10.5px;
        color: var(--text-s);
        border: 1px solid var(--border);
        background: var(--surface2);
        position: sticky;
        top: 0;
        z-index: 2;
        white-space: nowrap;
      }
      .gantt-table td {
        height: 54px;
        border: 1px solid var(--border);
        position: relative;
        background: rgba(255, 255, 255, 0.01);
      }
      html[data-theme="light"] .gantt-table td {
        background: rgba(15, 23, 42, 0.01);
      }
      .quarter-label {
        background: rgba(255, 255, 255, 0.05);
        font-weight: 900;
        font-size: 10.5px;
        color: var(--text-p);
        text-align: center;
      }

      .bar {
        position: absolute;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        padding: 0 12px;
        font-size: 11px;
        font-weight: 900;
        color: #000;
        top: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.18);
      }
      .milestone {
        position: absolute;
        top: -10px;
        font-size: 11px;
        font-weight: 900;
        color: var(--reg);
        border-left: 2px dashed var(--reg);
        padding-left: 8px;
        height: 74px;
        z-index: 5;
        white-space: nowrap;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.25);
      }

      /* ===== Filters / Lens ===== */
      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin: 8px 0 10px 0;
      }
      .seg {
        display: flex;
        border: 1px solid var(--border);
        border-radius: 14px;
        overflow: hidden;
        background: var(--surface2);
      }
      .seg button {
        border: 0;
        background: transparent;
        color: var(--text-s);
        padding: 10px 12px;
        font-size: var(--fs-12);
        font-weight: 900;
        cursor: pointer;
        transition:
          background 0.12s ease,
          color 0.12s ease;
      }
      .seg button.active {
        color: var(--text-p);
        background: rgba(0, 209, 255, 0.1);
      }
      html[data-theme="light"] .seg button.active {
        background: rgba(0, 209, 255, 0.12);
      }

      .select,
      .input {
        border: 1px solid var(--border);
        background: var(--surface2);
        color: var(--text-p);
        border-radius: 12px;
        padding: 10px 12px;
        font-size: var(--fs-12);
        font-weight: 900;
        outline: none;
        min-height: 40px;
      }
      .input {
        min-width: 280px;
      }
      .chipbar {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }
      .chip {
        border: 1px solid var(--border2);
        background: var(--surface2);
        color: var(--text-s);
        border-radius: 999px;
        padding: 9px 12px;
        font-size: 11.5px;
        font-weight: 900;
        cursor: pointer;
        user-select: none;
        transition:
          background 0.12s ease,
          border-color 0.12s ease,
          color 0.12s ease;
      }
      .chip.on {
        color: var(--text-p);
        border-color: rgba(0, 209, 255, 0.35);
        background: rgba(0, 209, 255, 0.12);
      }

      /* ===== WBS Table ===== */
      .wbs-wrap {
        overflow-x: auto;
      }
      table.wbs {
        width: 100%;
        min-width: 1400px;
        border-collapse: separate;
        border-spacing: 0;
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.01);
      }
      html[data-theme="light"] table.wbs {
        background: rgba(15, 23, 42, 0.01);
      }
      table.wbs th,
      table.wbs td {
        border-bottom: 1px solid var(--border);
        border-right: 1px solid var(--border);
        padding: 12px 12px;
        font-size: var(--fs-13);
        vertical-align: top;
        background-clip: padding-box;
      }
      table.wbs th:last-child,
      table.wbs td:last-child {
        border-right: 0;
      }
      table.wbs tr:last-child td {
        border-bottom: 0;
      }

      table.wbs th {
        background: var(--surface2);
        color: var(--text-s);
        font-weight: 900;
        font-size: 11.5px;
        letter-spacing: 0.4px;
        text-align: left;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 5;
      }

      /* Sticky first columns */
      .sticky-1 {
        position: sticky;
        left: 0;
        z-index: 6;
        background: var(--surface2);
      }
      .sticky-2 {
        position: sticky;
        left: 68px;
        z-index: 6;
        background: var(--surface2);
      }
      .sticky-3 {
        position: sticky;
        left: 170px;
        z-index: 6;
        background: var(--surface2);
      }
      /* body cells background for sticky cols */
      td.sticky-1,
      td.sticky-2,
      td.sticky-3 {
        background: rgba(255, 255, 255, 0.02);
      }
      html[data-theme="light"] td.sticky-1,
      html[data-theme="light"] td.sticky-2,
      html[data-theme="light"] td.sticky-3 {
        background: rgba(15, 23, 42, 0.02);
      }

      .dept-row td {
        background: rgba(255, 255, 255, 0.03);
        font-weight: 900;
        color: var(--text-p);
        font-size: var(--fs-13);
        position: sticky;
        top: 44px; /* header ë†’ì´ ê·¼ì‚¬ */
        z-index: 4;
      }
      html[data-theme="light"] .dept-row td {
        background: rgba(15, 23, 42, 0.03);
      }

      /* Zebra for readability */
      tbody tr.task-row:nth-child(even) td {
        background: rgba(255, 255, 255, 0.015);
      }
      html[data-theme="light"] tbody tr.task-row:nth-child(even) td {
        background: rgba(15, 23, 42, 0.012);
      }

      tbody tr.task-row:hover td {
        background: rgba(0, 209, 255, 0.06);
      }
      html[data-theme="light"] tbody tr.task-row:hover td {
        background: rgba(0, 209, 255, 0.08);
      }

      .dept-tag {
        display: inline-block;
        font-size: 10px;
        font-weight: 900;
        color: #000;
        padding: 4px 10px;
        border-radius: 8px;
        margin-right: 10px;
      }
      .cb {
        width: 18px;
        height: 18px;
        accent-color: var(--done);
        cursor: pointer;
        margin-top: 2px;
      }
      .mono {
        font-family: var(--mono);
      }
      .idcell {
        white-space: nowrap;
      }
      .steps {
        color: var(--text-s);
        font-size: 12px;
        line-height: 1.55;
      }
      .stepline {
        display: flex;
        gap: 8px;
        align-items: flex-start;
        margin: 3px 0;
      }
      .wtag {
        font-family: var(--mono);
        font-size: 10px;
        font-weight: 900;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid var(--border2);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text-p);
        white-space: nowrap;
        flex-shrink: 0;
        min-width: 38px;
        text-align: center;
      }
      html[data-theme="light"] .wtag {
        background: rgba(15, 23, 42, 0.03);
      }

      .outtag {
        display: inline-block;
        border: 1px solid var(--border2);
        background: rgba(255, 255, 255, 0.03);
        color: var(--text-s);
        font-size: 11px;
        font-weight: 900;
        padding: 5px 9px;
        border-radius: 10px;
        white-space: nowrap;
      }
      html[data-theme="light"] .outtag {
        background: rgba(15, 23, 42, 0.03);
      }

      .duetag {
        display: inline-block;
        font-family: var(--mono);
        font-size: 12px;
        font-weight: 900;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(251, 191, 36, 0.4);
        color: var(--reg);
        background: rgba(251, 191, 36, 0.1);
        white-space: nowrap;
      }
      .duetag.soon {
        border-color: rgba(251, 113, 133, 0.55);
        color: var(--danger);
        background: rgba(251, 113, 133, 0.1);
      }
      .duetag.over {
        border-color: rgba(251, 113, 133, 0.85);
        color: var(--danger);
        background: rgba(251, 113, 133, 0.16);
      }
      .duetag.mid {
        border-color: rgba(251, 191, 36, 0.55);
        background: rgba(251, 191, 36, 0.14);
      }
      .duemeta {
        display: block;
        margin-top: 8px;
        font-size: 11.5px;
        color: var(--text-s);
        white-space: nowrap;
      }

      .doneRow td {
        background: rgba(16, 185, 129, 0.06) !important;
      }
      html[data-theme="light"] .doneRow td {
        background: rgba(16, 185, 129, 0.08) !important;
      }
      .doneText {
        color: var(--done);
        text-decoration: line-through;
        opacity: 0.82;
      }

      .editHint {
        display: none;
        margin-top: 8px;
        font-size: 11.5px;
        color: var(--text-s);
      }
      .editable {
        border-radius: 8px;
        outline: none;
      }
      .editable[contenteditable="true"] {
        padding: 4px 6px;
        border: 1px dashed rgba(0, 209, 255, 0.55);
        background: rgba(0, 209, 255, 0.1);
      }

      /* ===== Reg tables ===== */
      table.dark {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.01);
      }
      html[data-theme="light"] table.dark {
        background: rgba(15, 23, 42, 0.01);
      }

      table.dark th,
      table.dark td {
        border-bottom: 1px solid var(--border);
        border-right: 1px solid var(--border);
        padding: 12px;
        font-size: var(--fs-13);
        vertical-align: top;
      }
      table.dark th:last-child,
      table.dark td:last-child {
        border-right: 0;
      }
      table.dark tr:last-child td {
        border-bottom: 0;
      }
      table.dark th {
        background: var(--surface2);
        color: var(--text-s);
        font-weight: 900;
        font-size: 11.5px;
        letter-spacing: 0.4px;
        text-align: left;
        white-space: nowrap;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      @media (max-width: 1200px) {
        .grid-2 {
          grid-template-columns: 1fr;
        }
      }

      /* ===== Minimal modal + toast ===== */
      .modal-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 18px;
      }
      .modal {
        width: min(460px, 100%);
        border-radius: 16px;
        border: 1px solid var(--border);
        background: var(--surface);
        box-shadow: var(--shadow);
        padding: 16px;
      }
      .modal h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        font-weight: 900;
        color: var(--text-p);
      }
      .modal p {
        margin: 0 0 12px 0;
        font-size: 12.5px;
        color: var(--text-s);
        line-height: 1.55;
      }
      .modal .row {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .modal .pw {
        flex: 1;
        border: 1px solid var(--border);
        background: var(--surface2);
        color: var(--text-p);
        border-radius: 12px;
        padding: 11px 12px;
        font-size: 13px;
        font-weight: 900;
        outline: none;
        font-family: var(--mono);
      }
      .toast-wrap {
        position: fixed;
        bottom: 18px;
        right: 18px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 10000;
      }
      .toast {
        border: 1px solid var(--border2);
        background: var(--surface);
        color: var(--text-p);
        padding: 10px 12px;
        border-radius: 14px;
        font-size: 12.5px;
        font-weight: 900;
        box-shadow: var(--shadow);
        max-width: 460px;
      }
      .toast.good {
        border-color: rgba(16, 185, 129, 0.45);
        background: rgba(16, 185, 129, 0.12);
      }
      .toast.bad {
        border-color: rgba(251, 113, 133, 0.55);
        background: rgba(251, 113, 133, 0.12);
      }

      /* Density toggle */
      body.compact .card {
        padding: 14px;
      }
      body.compact .btn {
        padding: 8px 10px;
      }
      body.compact .select,
      body.compact .input {
        padding: 9px 10px;
        min-height: 38px;
      }
      body.compact table.wbs th,
      body.compact table.wbs td {
        padding: 10px;
      }
      body.compact .p-card {
        padding: 12px;
      }
      body.compact .p-bar {
        height: 10px;
      }
    </style>
  </head>

  <body>
    <div class="container" id="app">
      <header>
        <div>
          <h1 class="h-title">
            AITRICS
            <span style="font-weight: 300">2026 Dr.Answer 3.0 Master</span>
          </h1>
          <p class="h-sub">
            ì—°ê°„-ë°˜ê¸°-ë¶„ê¸°-ì›”-ì£¼ì°¨ í•„í„° ê¸°ë°˜ WBS + ì¸í—ˆê°€ ê¸°ëŠ¥ë¶„ë¦¬/ì œì¶œìë£Œ
            í”„ë ˆì„ í†µí•© ëŒ€ì‹œë³´ë“œ
          </p>
        </div>

        <div class="right-stack">
          <div class="top-actions">
            <button
              class="btn ghost small"
              id="theme-btn"
              title="ë¼ì´íŠ¸/ë‹¤í¬ ì „í™˜"
            >
              ğŸŒ™
            </button>
            <button
              class="btn ghost small"
              id="density-btn"
              title="í‘œ ë°€ë„ ì „í™˜"
            >
              ê°€ë…ì„±: í¸ì•ˆ
            </button>

            <span class="badge" id="edit-badge">READ-ONLY</span>
            <button class="btn primary" id="edit-btn">ğŸ”’ í¸ì§‘</button>
            <button class="btn" id="save-btn" style="display: none">
              ì €ì¥
            </button>
            <button class="btn danger" id="exit-btn" style="display: none">
              í¸ì§‘ ì¢…ë£Œ
            </button>
          </div>

          <div class="total-stat">
            <div class="total-label">
              <span>TOTAL PROGRESS</span>
              <span class="badge" id="total-scope">SCOPE: -</span>
            </div>
            <div class="total-percent" id="total-val">0%</div>
          </div>
        </div>
      </header>

      <div class="nav">
        <a href="#timeline">ì „ëµ íƒ€ì„ë¼ì¸</a>
        <a href="#wbs">ì£¼ì°¨ WBS</a>
        <a href="#reg">ê¸°ëŠ¥ë¶„ë¦¬Â·ì¸í—ˆê°€</a>
        <a href="#top">ìƒë‹¨</a>
      </div>

      <div id="top" class="section-title">
        <span>ğŸ“</span> PROGRESS OVERVIEW (4 CATEGORIES)
      </div>
      <div class="card">
        <div class="grid-4" id="overview-grid"></div>
        <div class="note" style="margin-top: 10px">
          ìƒë‹¨ 4ê°œ í•­ëª©ì€ â€œí˜„ì¬ ì„ íƒëœ ê¸°ê°„(ë Œì¦ˆ/ê¸°ê°„)â€ ê¸°ì¤€ìœ¼ë¡œ WBS ì²´í¬ ìƒíƒœë¥¼
          ìë™ ì§‘ê³„í•˜ì—¬ í‘œì‹œí•¨.
        </div>
      </div>

      <div id="timeline" class="section-title">
        <span>ğŸ—“ï¸</span> STRATEGIC TIMELINE (Q1â€“Q4 2026)
      </div>

      <div class="card" style="padding: 12px 16px">
        <div class="filters" style="margin: 0">
          <div class="chipbar" id="macro-chips">
            <div class="chip on" data-macro="ALL">ALL</div>
            <div class="chip" data-macro="H1">H1</div>
            <div class="chip" data-macro="H2">H2</div>
            <div class="chip" data-macro="Q1">Q1</div>
            <div class="chip" data-macro="Q2">Q2</div>
            <div class="chip" data-macro="Q3">Q3</div>
            <div class="chip" data-macro="Q4">Q4</div>
          </div>
          <span class="badge" id="macro-view-badge">TIMELINE: ALL</span>
          <span class="note" style="margin: 0"
            >(ì„ íƒ ì‹œ WBS ë Œì¦ˆ/ê¸°ê°„ë„ ìë™ ë™ê¸°í™”)</span
          >
        </div>
      </div>

      <div class="card timeline-card">
        <div id="macro-timeline"></div>
      </div>

      <div id="wbs" class="section-title">
        <span>ğŸ”</span> MICRO-WBS: WEEKLY EXECUTION ITEMS (í•œ í–‰ í‘œì‹œ ì¤‘ì‹¬)
      </div>

      <div class="card">
        <div class="filters">
          <div class="seg" aria-label="time lens">
            <button class="active" data-lens="year">ì—°ì°¨</button>
            <button data-lens="half">ë°˜ê¸°</button>
            <button data-lens="quarter">ë¶„ê¸°</button>
            <button data-lens="month">ì›”</button>
            <button data-lens="week">ì£¼</button>
          </div>

          <select class="select" id="period-select" title="ê¸°ê°„ ì„ íƒ"></select>

          <select class="select" id="status-select" title="ìƒíƒœ">
            <option value="all">ì „ì²´</option>
            <option value="open">ë¯¸ì™„ë£Œ</option>
            <option value="done">ì™„ë£Œ</option>
          </select>

          <input
            class="input"
            id="search-input"
            placeholder="ê²€ìƒ‰ (ID/ë‚´ìš©/ì‚°ì¶œë¬¼)"
          />

          <span class="badge" id="count-badge">0 items</span>
          <span class="badge" id="date-badge"></span>
        </div>

        <div class="chipbar" id="dept-chips"></div>

        <div class="note" style="margin-top: 10px">
          ê¸°ê°„ ë Œì¦ˆ(ì—°ì°¨/ë°˜ê¸°/ë¶„ê¸°/ì›”/ì£¼)ë¡œ í•„í„°ë§ ì‹œ, í•´ë‹¹ ê¸°ê°„ì— ì†í•˜ëŠ” DUE
          íƒœìŠ¤í¬ë§Œ ë…¸ì¶œë¨. D-dayëŠ” ë¸Œë¼ìš°ì € ë‚ ì§œ ê¸°ì¤€ ìë™ ê³„ì‚°ë¨.
        </div>
      </div>

      <div class="card wbs-wrap">
        <table class="wbs" id="wbs-table">
          <thead>
            <tr>
              <th class="sticky-1" style="width: 68px">DONE</th>
              <th class="sticky-2" style="width: 102px">ID</th>
              <th class="sticky-3" style="min-width: 360px">ì—…ë¬´(1í–‰)</th>
              <th style="width: 460px">ì£¼ì°¨ë³„ ì„¸ë¶€ ì‹¤í–‰ í•­ëª©</th>
              <th style="width: 190px">DUE (D-â—‹ì¼)</th>
              <th style="width: 140px">ì‚°ì¶œë¬¼</th>
            </tr>
          </thead>
          <tbody id="wbs-body"></tbody>
        </table>
      </div>

      <div id="reg" class="section-title">
        <span>ğŸ§¾</span> FUNCTION SPLIT Â· CLASS(1/2) SUBMISSION FRAME
      </div>
      <div class="grid-2">
        <div class="card">
          <div style="font-weight: 900; font-size: 14px; margin-bottom: 10px">
            A. ê¸°ëŠ¥ë¶„ë¦¬(ì˜ë„ëœ ì‚¬ìš©/ì‚¬ìš©ì/í†µì œí¬ì¸íŠ¸) ì´ˆì•ˆ
          </div>
          <table class="dark">
            <thead>
              <tr>
                <th style="width: 18%">ëª¨ë“ˆ</th>
                <th style="width: 18%">ì£¼ ì‚¬ìš©ì</th>
                <th style="width: 18%">ì¶œë ¥ ì„±ê²©</th>
                <th style="width: 23%">ì˜ë£Œì§„ í†µì œ í¬ì¸íŠ¸</th>
                <th style="width: 23%">ë“±ê¸‰ ë¦¬ìŠ¤í¬(ê°€ì •)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><b>ë°ì´í„° ë³´ê¸°</b><br />Vent/EMR/PRO ë·°ì–´</td>
                <td>ì˜ë£Œì§„Â·ë³´í˜¸ì</td>
                <td>ì›ìë£Œ/ìš”ì•½(ê¸°ìˆ ì )</td>
                <td>í‘œì‹œí•­ëª©Â·ì•ŒëŒ ì„ê³„ì¹˜ ì˜ë£Œì§„ ì„¤ì •</td>
                <td>ë‹¨ìˆœ í‘œì‹œ ë²”ì£¼ ìœ ì§€ ì‹œ ì €ìœ„í—˜ ê°€ëŠ¥ì„±â†‘</td>
              </tr>
              <tr>
                <td><b>ì´ìƒì‹ í˜¸ íƒì§€</b><br />ì‹œê³„ì—´ ëª¨ë¸</td>
                <td>ì˜ë£Œì§„</td>
                <td>Risk score/íŒ¨í„´ í”Œë˜ê·¸</td>
                <td>í™•ì •/ì§„ë‹¨ ë¬¸êµ¬ ê¸ˆì§€, ê·¼ê±° ë¡œê·¸ ì œê³µ</td>
                <td>ì˜ì‚¬ê²°ì • ì§ì ‘ ìœ ë„ ì‹œ ìƒí–¥ ê°€ëŠ¥ì„±</td>
              </tr>
              <tr>
                <td><b>íŠ¸ë¦¬ì•„ì œ</b><br />3ë‹¨ê³„ ë¶„ë¥˜</td>
                <td>ë³´í˜¸ì(ìš°ì„ )</td>
                <td>í–‰ë™ ê¶Œê³ (ì‘ê¸‰/ë‹¹ì¼/ëª¨ë‹ˆí„°)</td>
                <td>ë¬¸êµ¬Â·ê¸°ì¤€ ì˜ë£Œì§„ ìŠ¹ì¸, ê³ ìœ„í—˜ ë³´ìˆ˜ì </td>
                <td>í–‰ë™ ë³€í™” ìœ ë„ ê°•í•¨ â†’ ìƒí–¥ ê°€ëŠ¥ì„±â†‘</td>
              </tr>
              <tr>
                <td><b>ì¼€ì–´ ê°€ì´ë“œ(LLM)</b><br />êµìœ¡Â·ì•ˆë‚´</td>
                <td>ë³´í˜¸ì</td>
                <td>ì¼ë°˜ ì•ˆë‚´/FAQ</td>
                <td>ê²€ìˆ˜ ì»¨í…ì¸ Â·ê¸ˆì¹™ì–´Â·ê°€ë“œë ˆì¼</td>
                <td>ê°œì¸ë§ì¶¤ â€œì²˜ë°©â€ í˜•íƒœ ê¸ˆì§€ í•„ìš”</td>
              </tr>
            </tbody>
          </table>
          <div class="note" style="margin-top: 10px">
            ë“±ê¸‰ í™•ì •ì€ â€œì˜ë„ëœ ì‚¬ìš©(Indications for Use)Â·ì‚¬ìš©ìÂ·ìœ„í—˜ë„â€ì— ì˜í•´
            ê²°ì •ë¨. íŠ¸ë¦¬ì•„ì œ/ê¶Œê³  í¬í•¨ ì‹œ Class II ìƒí–¥ ê°€ëŠ¥ì„± ì „ì œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ
            ë‘ëŠ” í¸ì´ ë°©ì–´ì ì„.
          </div>
        </div>

        <div class="card">
          <div style="font-weight: 900; font-size: 14px; margin-bottom: 10px">
            B. ì œì¶œìë£Œ ì°¨ë“±(ê°€ì •: Class I vs II) ì²´í¬ë¦¬ìŠ¤íŠ¸
          </div>
          <table class="dark">
            <thead>
              <tr>
                <th style="width: 34%">íŒ¨í‚¤ì§€ í•­ëª©</th>
                <th style="width: 33%">Class I ê°€ì •(ìµœì†Œ)</th>
                <th style="width: 33%">Class II ê°€ì •(ê°•í™”)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><b>SW ì„¤ëª…</b><br />ì•„í‚¤í…ì²˜/ë²„ì „/ë³€ê²½ì´ë ¥</td>
                <td>ê¸°ëŠ¥ëª©ë¡Â·ì‚¬ìš©í™˜ê²½Â·ë¡œê·¸</td>
                <td>ìƒì„¸ ì•„í‚¤í…ì²˜Â·ë°ì´í„°íë¦„Â·ì¶”ì ì„± ê°•í™”</td>
              </tr>
              <tr>
                <td><b>ìœ„í—˜ê´€ë¦¬</b><br />ìœ í•´ì‚¬ê±´Â·ì™„í™”Â·ì”ì—¬ë¦¬ìŠ¤í¬</td>
                <td>í•µì‹¬ ìœ„í—˜ ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ì‹¬</td>
                <td>íŠ¸ë¦¬ì•„ì œ/ì•ŒëŒ ì¤‘ì‹¬ ì „ìˆ˜í˜• ë¶„ì„ í•„ìš”</td>
              </tr>
              <tr>
                <td><b>ì„ìƒ/ì„±ëŠ¥ ê·¼ê±°</b></td>
                <td>ë‚´ë¶€ ì„±ëŠ¥ + ì œí•œì  ì‚¬ìš©ì í‰ê°€</td>
                <td>ì™¸ë¶€/êµì°¨ê²€ì¦ + ì„ìƒì  ìœ ìš©ì„± ê·¼ê±° ê°•í™”</td>
              </tr>
              <tr>
                <td><b>ì‚¬ì´ë²„ë³´ì•ˆ/SBOM</b></td>
                <td>ê¸°ë³¸ í†µì œ(ì ‘ê·¼ê¶Œí•œ/ì•”í˜¸í™”)</td>
                <td>ìœ„í˜‘ëª¨ë¸Â·ì·¨ì•½ì Â·SBOM ê°•í™” ê°€ëŠ¥ì„±</td>
              </tr>
              <tr>
                <td><b>ì‚¬ìš©ì í•©ì„±</b><br />(ë³´í˜¸ì UI)</td>
                <td>í•µì‹¬ í”Œë¡œìš° ì ê²€</td>
                <td>ì‘ê¸‰ ë¶„ê¸° ì¤‘ì‹¬ ì‚¬ìš©ì„± ê·¼ê±° ê°•í™”</td>
              </tr>
            </tbody>
          </table>
          <div class="note" style="margin-top: 10px">
            â€œClass Ië¡œ ë‹¨ì •â€ì€ ìœ„í—˜í•¨. íŠ¸ë¦¬ì•„ì œ(í–‰ë™ê¶Œê³ ) í¬í•¨ ì‹œ Class II ìƒí–¥
            ê°€ëŠ¥ì„± ì „ì œ í•„ìš”í•¨.
          </div>
        </div>
      </div>
    </div>

    <!-- password modal -->
    <div
      class="modal-backdrop"
      id="pw-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="pw-title"
    >
      <div class="modal">
        <h3 id="pw-title">í¸ì§‘ ëª¨ë“œ ì§„ì…</h3>
        <p>ë¹„ë°€ë²ˆí˜¸(1234) ì…ë ¥ ì‹œ ì¸ë¼ì¸ í¸ì§‘ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
        <div class="row">
          <input
            class="pw"
            id="pw-input"
            type="password"
            placeholder="PASSWORD"
            autocomplete="off"
          />
          <button class="btn primary" id="pw-ok">í™•ì¸</button>
          <button class="btn danger" id="pw-cancel">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <!-- toast -->
    <div class="toast-wrap" id="toast-wrap" aria-live="polite"></div>

    <script>
      /* =========================================================
   0) Utilities
========================================================= */
      const YEAR = 2026;
      const EDIT_PASSWORD = "1234"; // UI í¸ì§‘ ì§„ì…ìš©(ì €ì¥ ì‹œ ì„œë²„ì—ì„œë„ ë™ì¼ PIN ê²€ì¦ í•„ìš”)

      // UI preferenceëŠ” ë¡œì»¬ì— ìœ ì§€(ì €ì¥ì†Œ/ì—…ë¬´ë°ì´í„°ëŠ” êµ¬ê¸€ì‹œíŠ¸)
      const UI_THEME_KEY = "aitrics_2026_theme";
      const UI_DENSITY_KEY = "aitrics_2026_density";

      function deepClone(o) {
        return JSON.parse(JSON.stringify(o));
      }
      function clamp(n, a, b) {
        return Math.max(a, Math.min(b, n));
      }
      function pad2(n) {
        return String(n).padStart(2, "0");
      }
      function fmtDate(d) {
        const y = d.getFullYear(),
          m = pad2(d.getMonth() + 1),
          dd = pad2(d.getDate());
        return `${y}-${m}-${dd}`;
      }
      function parseYMD(ymd) {
        if (!ymd || typeof ymd !== "string") return null;
        const m = ymd.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if (!m) return null;
        const y = Number(m[1]),
          mo = Number(m[2]),
          da = Number(m[3]);
        const d = new Date(y, mo - 1, da);
        d.setHours(0, 0, 0, 0);
        return d;
      }

      /* ===== Google Apps Script bridge ===== */
      const IS_GAS =
        typeof google !== "undefined" && google.script && google.script.run;

      function gsRun(fnName, ...args) {
        return new Promise((resolve, reject) => {
          if (!IS_GAS) {
            reject(new Error("google.script.run not available"));
            return;
          }
          google.script.run
            .withSuccessHandler(resolve)
            .withFailureHandler(reject)
            [fnName](...args);
        });
      }

      /* ì›”-ì£¼ì°¨(Feb W1) â†’ ë‚ ì§œ(ê¸ˆìš”ì¼ ë§ˆê°) í™˜ì‚° ê·œì¹™ */
      const MONTH_MAP = {
        Jan: 1,
        Feb: 2,
        Mar: 3,
        Apr: 4,
        May: 5,
        Jun: 6,
        Jul: 7,
        Aug: 8,
        Sep: 9,
        Oct: 10,
        Nov: 11,
        Dec: 12,
      };

      function firstMondayOfMonth(year, month) {
        const d = new Date(year, month - 1, 1);
        const day = d.getDay(); // 0 Sun ... 1 Mon ... 6 Sat
        const diff = day === 0 ? 1 : day === 1 ? 0 : 8 - day;
        d.setDate(d.getDate() + diff);
        d.setHours(0, 0, 0, 0);
        return d;
      }
      function dueLabelToDate(dueLabel) {
        const m = dueLabel?.match(/^([A-Za-z]{3})\s+W(\d)$/);
        if (!m) return null;
        const mon = MONTH_MAP[m[1]];
        const w = Number(m[2]);
        if (!mon || !w) return null;

        const startMon = firstMondayOfMonth(YEAR, mon);
        const weekStart = new Date(startMon);
        weekStart.setDate(startMon.getDate() + (w - 1) * 7);

        const due = new Date(weekStart);
        due.setDate(weekStart.getDate() + 4); // Fri
        due.setHours(0, 0, 0, 0);
        return due;
      }
      function dDayDiff(dueDate) {
        if (!dueDate) return null;
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const due = new Date(dueDate);
        due.setHours(0, 0, 0, 0);
        return Math.round((due - today) / 86400000);
      }
      function dDayString(dueDate) {
        if (!dueDate) return "D-?";
        const diff = dDayDiff(dueDate);
        if (diff === null) return "D-?";
        if (diff >= 0) return `D-${diff}ì¼`;
        return `D+${Math.abs(diff)}ì¼`;
      }

      /* í”„ë¡œì íŠ¸ íƒ€ì„ë¼ì¸ ê¸°ì¤€(02~12)ìœ¼ë¡œ ë°˜ê¸°/ë¶„ê¸° ì •ì˜ */
      function quarterOfDate(d) {
        const m = d.getMonth() + 1;
        if (m >= 2 && m <= 4) return "Q1";
        if (m >= 5 && m <= 7) return "Q2";
        if (m >= 8 && m <= 10) return "Q3";
        return "Q4";
      }
      function halfOfDate(d) {
        const m = d.getMonth() + 1;
        if (m >= 2 && m <= 7) return "H1";
        return "H2";
      }
      function monthKey(d) {
        const m = pad2(d.getMonth() + 1);
        return `${YEAR}-${m}`;
      }
      function isoWeek(d) {
        const date = new Date(
          Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()),
        );
        const dayNum = date.getUTCDay() || 7;
        date.setUTCDate(date.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
        return Math.ceil(((date - yearStart) / 86400000 + 1) / 7);
      }
      function lensKey(lens, task) {
        const due = task.dueDate;
        if (!due) return "UNKNOWN";
        if (lens === "year") return String(YEAR);
        if (lens === "half") return halfOfDate(due);
        if (lens === "quarter") return quarterOfDate(due);
        if (lens === "month") return monthKey(due);
        if (lens === "week") return task.dueLabel || `W${isoWeek(due)}`;
        return "ALL";
      }
      function lensLabel(lens, key) {
        if (lens === "year") return `${key}ë…„`;
        if (lens === "half") return key === "H1" ? "ìƒë°˜ê¸°(H1)" : "í•˜ë°˜ê¸°(H2)";
        if (lens === "quarter") return `ë¶„ê¸° ${key}`;
        if (lens === "month") {
          const mm = key.split("-")[1];
          return `${mm}ì›”`;
        }
        if (lens === "week") return key;
        return key;
      }

      /* Toast / Modal */
      function toast(msg, type = "") {
        const wrap = document.getElementById("toast-wrap");
        const el = document.createElement("div");
        el.className =
          "toast " + (type === "good" ? "good" : type === "bad" ? "bad" : "");
        el.textContent = msg;
        wrap.appendChild(el);
        setTimeout(() => {
          el.style.opacity = "0";
          el.style.transform = "translateY(6px)";
        }, 2200);
        setTimeout(() => {
          el.remove();
        }, 3000);
      }
      function openPwModal(onOk) {
        const bd = document.getElementById("pw-backdrop");
        const inp = document.getElementById("pw-input");
        const ok = document.getElementById("pw-ok");
        const cancel = document.getElementById("pw-cancel");

        function close() {
          bd.style.display = "none";
          inp.value = "";
          ok.onclick = null;
          cancel.onclick = null;
          bd.onclick = null;
          inp.onkeydown = null;
        }

        bd.style.display = "flex";
        inp.focus();

        ok.onclick = () => {
          onOk(inp.value);
          close();
        };
        cancel.onclick = () => {
          close();
        };

        bd.onclick = (e) => {
          if (e.target === bd) close();
        };

        inp.onkeydown = (e) => {
          if (e.key === "Enter") {
            onOk(inp.value);
            close();
          }
          if (e.key === "Escape") {
            close();
          }
        };
      }

      /* =========================================================
   1) Data (default)
========================================================= */
      const DEFAULT_DATA = {
        roadmap: [
          {
            dept: "ë°ì´í„°/ì¸í”„ë¼ ì—°ê³„",
            color: "var(--data)",
            category: "DATA PIPELINE",
            tasks: [
              {
                id: "D-1.1",
                text: "GPU ì„œë²„ ë° ì›Œí¬ìŠ¤í…Œì´ì…˜ ì¸í”„ë¼ êµ¬ì¶•",
                out: "ì„¤ì¹˜ê³µë¬¸",
                checked: true,
                dueLabel: "Feb W1",
                steps: [
                  { week: "W1", label: "ì„œë²„ ì…ê³  í™•ì¸" },
                  { week: "W1", label: "OS/ë“œë¼ì´ë²„ ì„¸íŒ…" },
                  { week: "W2", label: "ì›ë‚´ ë„¤íŠ¸ì›Œí¬/ë°©í™”ë²½ ì—°ê³„" },
                ],
              },
              {
                id: "D-1.2",
                text: "EMR/MDIP ë°ì´í„° ì—°ê³„ í™•ì¸",
                out: "ì ‘ê·¼ê¶Œí•œ",
                checked: true,
                dueLabel: "Feb W2",
                steps: [
                  { week: "W2", label: "EMR í…Œì´ë¸”Â·ë³€ìˆ˜ ë§µí•‘" },
                  { week: "W3", label: "MDIP ì—°ë™ ì¸í„°í˜ì´ìŠ¤ í…ŒìŠ¤íŠ¸" },
                  { week: "W3", label: "ì¶”ì¶œ ë¡œê·¸/ì—ëŸ¬ì½”ë“œ í‘œì¤€í™”" },
                ],
              },
              {
                id: "D-1.3",
                text: "T-Bridge ë°ì´í„° ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„",
                out: "API_Spec",
                checked: false,
                dueLabel: "Mar W4",
                steps: [
                  { week: "W1", label: "ì¥ë¹„ ì‹ í˜¸ ìˆ˜ì§‘ ê·œê²© ì •ì˜" },
                  { week: "W3", label: "ìŠ¤íŠ¸ë¦¬ë°/ë°°ì¹˜ API ì„¤ê³„" },
                  { week: "W4", label: "ì—ëŸ¬Â·ì¬ì „ì†¡Â·ëˆ„ë½ ì²˜ë¦¬ ì •ì˜" },
                ],
              },
              {
                id: "D-1.4",
                text: "ì´ìƒì¹˜/ê²°ì¸¡ ì²˜ë¦¬ ë° ìˆ˜ì§‘ íŒŒì´í”„ë¼ì¸ ê°œë°œ",
                out: "Pipeline",
                checked: false,
                dueLabel: "May W4",
                steps: [
                  { week: "W2", label: "ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ê·œì¹™/ë³´ê°„ ì •ì±…" },
                  { week: "W3", label: "ì´ìƒì¹˜ ì •ì˜Â·í”Œë˜ê·¸ ì²´ê³„" },
                  { week: "W4", label: "íŒŒì´í”„ë¼ì¸ ì„±ëŠ¥/ì¬í˜„ì„± ìµœì í™”" },
                ],
              },
            ],
          },
          {
            dept: "AI ì•Œê³ ë¦¬ì¦˜ ê°œë°œ",
            color: "var(--ai)",
            category: "AI MODELING",
            tasks: [
              {
                id: "A-2.1",
                text: "ì•…í™”/ì´ìƒ ì‹œê·¸ë„ ë ˆì´ë¸”ë§ ê¸°ì¤€ ìˆ˜ë¦½",
                out: "Label_Guide",
                checked: false,
                dueLabel: "Mar W2",
                steps: [
                  { week: "W1", label: "ì˜ë£Œì§„ í•©ì˜ ê¸°ì¤€ ì´ˆì•ˆ" },
                  { week: "W2", label: "ë ˆì´ë¸”ë§ ë„êµ¬/ì›Œí¬í”Œë¡œìš° ê²°ì •" },
                  { week: "W2", label: "ì¼ì¹˜ë„(IAA) ì ê²€ ì„¤ê³„" },
                ],
              },
              {
                id: "A-2.2",
                text: "Vent ì›ì²œë°ì´í„° ìƒ˜í”Œ EDA ë° íŠ¹ì§•ì •ì˜",
                out: "EDA_Report",
                checked: false,
                dueLabel: "Mar W4",
                steps: [
                  { week: "W2", label: "ì‹ í˜¸ í’ˆì§ˆ ë¶„í¬/ê²°ì¸¡ íŒ¨í„´ ë¶„ì„" },
                  { week: "W3", label: "ì„ìƒ ì´ë²¤íŠ¸ í›„ë³´ í”¼ì²˜ ì •ì˜" },
                  { week: "W4", label: "ëª¨ë¸ ì…ë ¥ í…ì„œ ìŠ¤í™ í™•ì •" },
                ],
              },
              {
                id: "A-2.3",
                text: "Transformer ê¸°ë°˜ ì‹œê³„ì—´ ëª¨ë¸ + Agent êµ¬ì¡° ì„¤ê³„",
                out: "Arch_v1",
                checked: false,
                dueLabel: "May W2",
                steps: [
                  { week: "W2", label: "ì‹œê³„ì—´ ëª¨ë¸ baseline ì •ì˜" },
                  { week: "W3", label: "Agent I/OÂ·ë¡œê·¸ ìŠ¤í‚¤ë§ˆ" },
                  { week: "W4", label: "ì„ê³„ì¹˜/ë¶ˆí™•ì‹¤ì„± ì²˜ë¦¬ ë£°" },
                ],
              },
            ],
          },
          {
            dept: "ì„œë¹„ìŠ¤ ê°œë°œ/êµ¬í˜„",
            color: "var(--svc)",
            category: "SERVICE/UX",
            tasks: [
              {
                id: "P-3.1",
                text: "ë³´í˜¸ì ì¸í„°ë·° ë° ë‹ˆì¦ˆ ë¶„ì„(íŠ¸ë¦¬ì•„ì œ 3ë‹¨ê³„ í¬í•¨)",
                out: "FGI_Report",
                checked: false,
                dueLabel: "Mar W4",
                steps: [
                  { week: "W2", label: "ëŒ€ìƒì ì„ ì •/ë™ì˜ ì ˆì°¨ ì •ë¦¬" },
                  { week: "W4", label: "FGI ìˆ˜í–‰Â·í˜ì¸í¬ì¸íŠ¸ ë„ì¶œ" },
                ],
              },
              {
                id: "P-3.2",
                text: "íŠ¸ë¦¬ì•„ì œ 3ë‹¨ê³„ ë¶„ê¸°(ì‘ê¸‰/ë‹¹ì¼/ëª¨ë‹ˆí„°) UX ë¬¸êµ¬ ì„¤ê³„",
                out: "Flowchart",
                checked: false,
                dueLabel: "Apr W4",
                steps: [
                  { week: "W2", label: "ë¶„ê¸° íŠ¸ë¦¬(ë³´ìˆ˜ì ) ì´ˆì•ˆ" },
                  { week: "W3", label: "ì˜ë£Œì§„ ë¬¸êµ¬/ê¸ˆì¹™ì–´ ê²€ìˆ˜" },
                  { week: "W4", label: "ì‚¬ìš©ì í•©ì„± ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„±" },
                ],
              },
              {
                id: "P-3.3",
                text: "UI ê¸°íš ë° PRO í•­ëª©/ì£¼ê¸° ì„¤ê³„",
                out: "Figma",
                checked: false,
                dueLabel: "May W4",
                steps: [
                  { week: "W2", label: "í™”ë©´ íë¦„ë„(Wireframe) ì‘ì„±" },
                  { week: "W3", label: "PRO ë¬¸í•­Â·ì…ë ¥ì£¼ê¸°(ë¶€ë‹´) ì„¤ê³„" },
                  { week: "W4", label: "Figma ìƒì„¸ í”„ë¡œí† íƒ€ì…" },
                ],
              },
            ],
          },
          {
            dept: "ì¸í—ˆê°€/í’ˆì§ˆ(RA/QA)",
            color: "var(--reg)",
            category: "REGULATORY",
            tasks: [
              {
                id: "R-4.1",
                text: "SaMD ì‚¬ì „ìƒë‹´(ì˜ë„ëœ ì‚¬ìš©Â·ë“±ê¸‰Â·ê¸°ëŠ¥ë¶„ë¦¬) íŒ¨í‚¤ì§€",
                out: "Q&A_Doc",
                checked: false,
                dueLabel: "Mar W4",
                steps: [
                  { week: "W2", label: "ì˜ë„ëœ ì‚¬ìš©/ì‚¬ìš©ì/ì¶œë ¥ ë¬¸êµ¬ í™•ì •" },
                  { week: "W3", label: "ê¸°ëŠ¥ë¶„ë¦¬ ì‹œë‚˜ë¦¬ì˜¤Â·ë¦¬ìŠ¤í¬ ìš”ì•½" },
                  { week: "W4", label: "íšŒì˜ ìˆ˜í–‰Â·í•©ì˜ì‚¬í•­ ê¸°ë¡" },
                ],
              },
              {
                id: "R-4.2",
                text: "SW ìˆ˜ëª…ì£¼ê¸°Â·ì¶”ì ì„±Â·ì‹œí—˜ì „ëµ ë¬¸ì„œí™”",
                out: "Dev_QMS",
                checked: false,
                dueLabel: "Jun W4",
                steps: [
                  { week: "W2", label: "ìš”êµ¬ì‚¬í•­-ì„¤ê³„-ì‹œí—˜ ì¶”ì ì„± í…œí”Œë¦¿" },
                  { week: "W3", label: "V&V(ê²€ì¦/ìœ íš¨ì„±) ê³„íš" },
                  { week: "W4", label: "ë¦´ë¦¬ì¦ˆ/ë³€ê²½ê´€ë¦¬ ì ˆì°¨" },
                ],
              },
              {
                id: "R-4.3",
                text: "ê¸°ìˆ ë¬¸ì„œ íŒ¨í‚¤ì§•(ì„±ëŠ¥Â·ìœ„í—˜ê´€ë¦¬Â·ì‚¬ìš©ì í•©ì„±) ì´ˆì•ˆ",
                out: "Tech_File",
                checked: false,
                dueLabel: "Dec W2",
                steps: [
                  { week: "W1", label: "ì„±ëŠ¥í‰ê°€ ê²°ê³¼ì„œ í†µí•©" },
                  { week: "W2", label: "ìœ„í—˜ê´€ë¦¬Â·ë¼ë²¨ë§Â·ê°€ë“œë ˆì¼ ê·¼ê±° ì •ë¦¬" },
                ],
              },
            ],
          },
        ],
      };

      /* =========================================================
   1.1) Persistence: Google Sheet (Apps Script)
========================================================= */
      let DATA = deepClone(DEFAULT_DATA);
      let EDIT_PIN_SESSION = null; // í¸ì§‘ ì§„ì… ì„±ê³µ ì‹œ PIN ì €ì¥(ì €ì¥ í˜¸ì¶œ ë•Œ ì„œë²„ì— ì „ë‹¬)
      let editMode = false;

      async function loadFromGoogle() {
        const res = await gsRun("loadData"); // Code.gsì˜ loadData()
        if (res && res.ok && res.data && typeof res.data === "object") {
          DATA = res.data;
        } else {
          DATA = deepClone(DEFAULT_DATA);
        }
      }

      async function saveToGoogle() {
        const res = await gsRun("saveData", DATA, EDIT_PIN_SESSION); // Code.gsì˜ saveData(payload, pin)
        return res;
      }

      /* =========================================================
   2) State (filters)
========================================================= */
      let lens = "year";
      let periodKey = String(YEAR);
      let statusFilter = "all";
      let searchQuery = "";
      let deptFilter = new Set();
      let macroView = "ALL";

      /* =========================================================
   2.1) Macro Timeline Model
========================================================= */
      const macroMonths = [
        "02",
        "03",
        "04",
        "05",
        "06",
        "07",
        "08",
        "09",
        "10",
        "11",
        "12",
      ];
      const macroMeta = {
        fullUnits: macroMonths.length,
        ranges: {
          ALL: { start: 0, end: 11, label: "ALL" },
          H1: { start: 0, end: 6, label: "H1" },
          H2: { start: 6, end: 11, label: "H2" },
          Q1: { start: 0, end: 3, label: "Q1" },
          Q2: { start: 3, end: 6, label: "Q2" },
          Q3: { start: 6, end: 9, label: "Q3" },
          Q4: { start: 9, end: 11, label: "Q4" },
        },
      };

      const macroRows = [
        {
          key: "DATA PIPELINE",
          color: "var(--data)",
          bars: [
            {
              leftPct: 0,
              widthPct: 36,
              bg: "var(--data)",
              label: "INFRA Â· T-Bridge/EMR/MDIP ì—°ê³„",
            },
          ],
          milestones: [
            { leftPct: 0, label: "ğŸš© ì¸í”„ë¼ ì„¤ì¹˜", color: "var(--reg)" },
            { leftPct: 27, label: "ğŸš© íŒŒì´í”„ë¼ì¸ 1ì°¨", color: "var(--reg)" },
          ],
        },
        {
          key: "AI MODELING",
          color: "var(--ai)",
          bars: [
            {
              leftPct: 9,
              widthPct: 36,
              bg: "var(--ai)",
              label: "Transformer ì‹œê³„ì—´ Â· Agent ì„¤ê³„/ë³´ì •",
            },
          ],
          milestones: [
            { leftPct: 36, label: "ğŸš© ë‚´ë¶€ê²€ì¦ v1", color: "var(--ai)" },
          ],
        },
        {
          key: "SERVICE/UX",
          color: "var(--svc)",
          bars: [
            {
              leftPct: 0,
              widthPct: 63,
              bg: "var(--svc)",
              label: "ë³´í˜¸ì ì•± Â· ì˜ë£Œì§„ UI Â· ìš”ì•½/ê°€ì´ë“œ",
            },
          ],
          milestones: [
            { leftPct: 45, label: "ğŸš© PRO ê²€ì¦", color: "var(--svc)" },
          ],
        },
        {
          key: "REGULATORY",
          color: "var(--reg)",
          bars: [
            {
              leftPct: 9,
              widthPct: 90,
              bg: "var(--reg)",
              label: "SaMD ì œì¶œìë£Œ íŒ¨í‚¤ì§€ Â· ê¸°ëŠ¥ë¶„ë¦¬ ì „ëµ",
            },
          ],
          milestones: [
            { leftPct: 18, label: "ğŸš© ì‚¬ì „ìƒë‹´", color: "var(--reg)" },
            { leftPct: 81, label: "ğŸš© ì œì¶œë³¸ ë™ê²°", color: "var(--reg)" },
          ],
        },
      ];

      function projectBarToVisible(bar) {
        const full = macroMeta.fullUnits;
        const r = macroMeta.ranges[macroView] || macroMeta.ranges.ALL;
        const vSpan = r.end - r.start;

        const startU = (bar.leftPct / 100) * full;
        const endU = startU + (bar.widthPct / 100) * full;

        const isUStart = Math.max(startU, r.start);
        const isUEnd = Math.min(endU, r.end);

        if (isUEnd <= isUStart) return null;

        const leftPct = ((isUStart - r.start) / vSpan) * 100;
        const widthPct = ((isUEnd - isUStart) / vSpan) * 100;
        return { leftPct, widthPct };
      }
      function projectMilestoneToVisible(ms) {
        const full = macroMeta.fullUnits;
        const r = macroMeta.ranges[macroView] || macroMeta.ranges.ALL;
        const vSpan = r.end - r.start;

        const posU = (ms.leftPct / 100) * full;
        if (posU < r.start || posU > r.end) return null;

        const leftPct = ((posU - r.start) / vSpan) * 100;
        return { leftPct };
      }
      function renderMacroTimeline() {
        const r = macroMeta.ranges[macroView] || macroMeta.ranges.ALL;
        const visibleMonths = macroMonths.slice(r.start, r.end);
        const c = visibleMonths.length;

        const headerQuarterRow = (() => {
          if (macroView === "ALL") {
            return `<tr>
        <th rowspan="2" style="width:160px;">KPI CATEGORY</th>
        <th colspan="3" class="quarter-label">Q1</th>
        <th colspan="3" class="quarter-label">Q2</th>
        <th colspan="3" class="quarter-label">Q3</th>
        <th colspan="2" class="quarter-label">Q4</th>
      </tr>`;
          }
          if (macroView === "H1") {
            return `<tr>
        <th rowspan="2" style="width:160px;">KPI CATEGORY</th>
        <th colspan="3" class="quarter-label">Q1</th>
        <th colspan="3" class="quarter-label">Q2</th>
      </tr>`;
          }
          if (macroView === "H2") {
            return `<tr>
        <th rowspan="2" style="width:160px;">KPI CATEGORY</th>
        <th colspan="3" class="quarter-label">Q3</th>
        <th colspan="2" class="quarter-label">Q4</th>
      </tr>`;
          }
          return `<tr>
      <th rowspan="2" style="width:160px;">KPI CATEGORY</th>
      <th colspan="${c}" class="quarter-label">${macroView}</th>
    </tr>`;
        })();

        const headerMonthRow = `<tr>${visibleMonths.map((m) => `<th>${m}</th>`).join("")}</tr>`;

        const body = macroRows
          .map((row) => {
            const barsHtml = (row.bars || [])
              .map((b) => {
                const p = projectBarToVisible(b);
                if (!p) return "";
                return `<div class="bar" style="width:${p.widthPct}%;background:${b.bg};left:${p.leftPct}%;">${b.label}</div>`;
              })
              .join("");

            const msHtml = (row.milestones || [])
              .map((ms) => {
                const p = projectMilestoneToVisible(ms);
                if (!p) return "";
                const col = ms.color || "var(--reg)";
                return `<div class="milestone" style="left:${p.leftPct}%; color:${col}; border-left-color:${col};">${ms.label}</div>`;
              })
              .join("");

            return `<tr>
      <td style="font-size:12px;font-weight:900;padding-left:14px;color:${row.color};">${row.key}</td>
      <td colspan="${c}">
        ${barsHtml}
        ${msHtml}
      </td>
    </tr>`;
          })
          .join("");

        document.getElementById("macro-timeline").innerHTML = `
    <table class="gantt-table">
      <thead>
        ${headerQuarterRow}
        ${headerMonthRow}
      </thead>
      <tbody>${body}</tbody>
    </table>
  `;
        document.getElementById("macro-view-badge").textContent =
          `TIMELINE: ${r.label}`;
      }

      /* =========================================================
   3) Due hydration
========================================================= */
      function hydrateDueDates() {
        DATA.roadmap.forEach((g) => {
          g.tasks.forEach((t) => {
            const d = dueLabelToDate(t.dueLabel);
            t.dueDate = d ? fmtDate(d) : null;
          });
        });
      }

      /* =========================================================
   4) Scope helpers
========================================================= */
      function taskInCurrentScope(task) {
        const d = task.dueDate
          ? parseYMD(task.dueDate)
          : task.dueLabel
            ? dueLabelToDate(task.dueLabel)
            : null;
        if (!d) return false;
        const k = lensKey(lens, { dueDate: d, dueLabel: task.dueLabel });
        return k === periodKey;
      }

      /* =========================================================
   5) Rendering: Overview / Total
========================================================= */
      function renderOverview() {
        const grid = document.getElementById("overview-grid");
        grid.innerHTML = "";

        const catOrder = [
          "DATA PIPELINE",
          "AI MODELING",
          "SERVICE/UX",
          "REGULATORY",
        ];
        const catColor = {
          "DATA PIPELINE": "var(--data)",
          "AI MODELING": "var(--ai)",
          "SERVICE/UX": "var(--svc)",
          REGULATORY: "var(--reg)",
        };
        const cats = {};
        catOrder.forEach((c) => (cats[c] = { done: 0, total: 0 }));

        DATA.roadmap.forEach((g) => {
          g.tasks.forEach((t) => {
            if (!taskInCurrentScope(t)) return;
            if (!cats[g.category]) return;
            cats[g.category].total += 1;
            if (t.checked) cats[g.category].done += 1;
          });
        });

        catOrder.forEach((c) => {
          const done = cats[c].done,
            total = cats[c].total;
          const pct = total ? Math.round((done / total) * 100) : 0;
          const el = document.createElement("div");
          el.className = "p-card";
          el.innerHTML = `
      <div class="p-top">
        <div class="p-name">${c}</div>
        <div class="p-meta">${pct}%<br/><span>${done}/${total}</span></div>
      </div>
      <div class="p-bar"><div class="p-fill" style="width:${pct}%; background:${catColor[c]};"></div></div>
      <div class="p-foot">
        <span class="pill">SCOPE: ${lensLabel(lens, periodKey)}</span>
        <span class="pill">YEAR: 2026</span>
      </div>
    `;
          grid.appendChild(el);
        });
      }

      function renderTotal() {
        let total = 0,
          done = 0;
        DATA.roadmap.forEach((g) => {
          g.tasks.forEach((t) => {
            if (!taskInCurrentScope(t)) return;
            total += 1;
            if (t.checked) done += 1;
          });
        });
        document.getElementById("total-val").innerText = total
          ? Math.round((done / total) * 100) + "%"
          : "0%";
        document.getElementById("total-scope").textContent =
          `SCOPE: ${lensLabel(lens, periodKey)}`;
      }

      /* =========================================================
   6) Filters
========================================================= */
      function getAllTasksFlat() {
        const list = [];
        DATA.roadmap.forEach((g) => {
          g.tasks.forEach((t) =>
            list.push({
              ...t,
              _dept: g.dept,
              _color: g.color,
              _category: g.category,
            }),
          );
        });
        return list;
      }

      function buildPeriods() {
        const tasks = getAllTasksFlat();
        const keys = new Set();

        tasks.forEach((t) => {
          const d = t.dueDate
            ? parseYMD(t.dueDate)
            : t.dueLabel
              ? dueLabelToDate(t.dueLabel)
              : null;
          if (!d) return;
          const key = lensKey(lens, { dueDate: d, dueLabel: t.dueLabel });
          if (key && key !== "UNKNOWN") keys.add(key);
        });

        let list = Array.from(keys);
        if (lens === "year") {
          list = [String(YEAR)];
        } else if (lens === "half") {
          list = ["H1", "H2"].filter((k) => keys.has(k));
        } else if (lens === "quarter") {
          list = ["Q1", "Q2", "Q3", "Q4"].filter((k) => keys.has(k));
        } else if (lens === "month") {
          list.sort();
        } else if (lens === "week") {
          list.sort((a, b) => {
            const da = dueLabelToDate(a);
            const db = dueLabelToDate(b);
            if (da && db) return da - db;
            if (da) return -1;
            if (db) return 1;
            return String(a).localeCompare(String(b));
          });
        }

        const sel = document.getElementById("period-select");
        sel.innerHTML = "";
        list.forEach((k) => {
          const opt = document.createElement("option");
          opt.value = k;
          opt.textContent = lensLabel(lens, k);
          sel.appendChild(opt);
        });

        if (!list.includes(periodKey)) periodKey = list[0] || String(YEAR);
        sel.value = periodKey;

        document.getElementById("date-badge").textContent =
          `TODAY: ${fmtDate(new Date())}`;
      }

      function renderDeptChips() {
        const wrap = document.getElementById("dept-chips");
        wrap.innerHTML = "";
        const depts = DATA.roadmap.map((g) => g.dept);

        const allChip = document.createElement("div");
        allChip.className = "chip " + (deptFilter.size === 0 ? "on" : "");
        allChip.textContent = "ì „ì²´";
        allChip.onclick = () => {
          deptFilter.clear();
          renderAll();
        };
        wrap.appendChild(allChip);

        depts.forEach((d) => {
          const chip = document.createElement("div");
          chip.className = "chip " + (deptFilter.has(d) ? "on" : "");
          chip.textContent = d;
          chip.onclick = () => {
            if (deptFilter.has(d)) deptFilter.delete(d);
            else deptFilter.add(d);
            renderAll();
          };
          wrap.appendChild(chip);
        });
      }

      function passesFilters(task, group) {
        if (deptFilter.size > 0 && !deptFilter.has(group.dept)) return false;

        if (statusFilter === "open" && task.checked) return false;
        if (statusFilter === "done" && !task.checked) return false;

        if (searchQuery) {
          const hay =
            `${task.id} ${task.text} ${task.out} ${task.dueLabel}`.toLowerCase();
          if (!hay.includes(searchQuery.toLowerCase())) return false;
        }

        const d = task.dueDate
          ? parseYMD(task.dueDate)
          : task.dueLabel
            ? dueLabelToDate(task.dueLabel)
            : null;
        if (!d) return false;

        const key = lensKey(lens, { dueDate: d, dueLabel: task.dueLabel });
        if (key !== periodKey) return false;

        return true;
      }

      /* =========================================================
   7) Render WBS table
========================================================= */
      function renderWBS() {
        const body = document.getElementById("wbs-body");
        body.innerHTML = "";

        let visibleCount = 0;

        DATA.roadmap.forEach((g, gIdx) => {
          const filteredTasks = g.tasks.filter((t) => passesFilters(t, g));
          if (filteredTasks.length === 0) return;

          const trh = document.createElement("tr");
          trh.className = "dept-row";
          trh.innerHTML = `
      <td colspan="6">
        <span class="dept-tag" style="background:${g.color};">DEPT</span>
        ${g.dept}
        <span class="badge" style="margin-left:10px;">${g.category}</span>
      </td>
    `;
          body.appendChild(trh);

          filteredTasks.forEach((t) => {
            visibleCount++;

            const dueObj = t.dueDate
              ? parseYMD(t.dueDate)
              : t.dueLabel
                ? dueLabelToDate(t.dueLabel)
                : null;
            const diff = dueObj ? dDayDiff(dueObj) : null;

            const dday = dDayString(dueObj);
            const dueDateStr = dueObj ? fmtDate(dueObj) : "UNKNOWN";

            let dueClass = "";
            if (diff !== null) {
              if (diff < 0) dueClass = "over";
              else if (diff <= 7) dueClass = "soon";
              else if (diff <= 30) dueClass = "mid";
            }

            const tr = document.createElement("tr");
            tr.className = "task-row";
            if (t.checked) tr.classList.add("doneRow");

            const stepsHtml = (t.steps || [])
              .map(
                (s, sIdx) => `
        <div class="stepline">
          <span class="wtag">${s.week}</span>
          <span class="${editMode ? "editable" : ""}" data-role="step" data-g="${gIdx}" data-id="${t.id}" data-step-idx="${sIdx}">${s.label}</span>
        </div>
      `,
              )
              .join("");

            tr.innerHTML = `
        <td class="sticky-1">
          <input class="cb" type="checkbox" ${t.checked ? "checked" : ""} ${editMode ? "" : "disabled"} data-g="${gIdx}" data-tid="${t.id}">
        </td>
        <td class="sticky-2 idcell mono" style="color:${g.color}; font-weight:900;">
          <span class="${editMode ? "editable" : ""}" data-role="id" data-g="${gIdx}" data-id="${t.id}">${t.id}</span>
        </td>
        <td class="sticky-3">
          <div class="${t.checked ? "doneText" : ""} ${editMode ? "editable" : ""}" data-role="text" data-g="${gIdx}" data-id="${t.id}" style="font-weight:900;">
            ${t.text}
          </div>
          <div class="editHint">í¸ì§‘ ëª¨ë“œ: í…ìŠ¤íŠ¸ í´ë¦­ í›„ ìˆ˜ì • ê°€ëŠ¥</div>
        </td>
        <td class="steps">${stepsHtml || `<span style="color:var(--text-s)">-</span>`}</td>
        <td>
          <span class="duetag ${dueClass}">${dday}</span>
          <span class="duemeta">
            <span class="${editMode ? "editable" : ""}" data-role="dueLabel" data-g="${gIdx}" data-id="${t.id}">${t.dueLabel || "-"}</span>
            Â· <span class="mono">${dueDateStr}</span>
          </span>
        </td>
        <td>
          <span class="outtag ${editMode ? "editable" : ""}" data-role="out" data-g="${gIdx}" data-id="${t.id}">${t.out || "-"}</span>
        </td>
      `;
            body.appendChild(tr);
          });
        });

        document.getElementById("count-badge").textContent =
          `${visibleCount} items`;

        // checkbox
        body.querySelectorAll("input.cb").forEach((cb) => {
          cb.onchange = () => {
            if (!editMode) {
              cb.checked = !cb.checked;
              return;
            }
            const gIdx = Number(cb.dataset.g);
            const id = cb.dataset.tid;
            const task = DATA.roadmap[gIdx].tasks.find((x) => x.id === id);
            if (!task) return;
            task.checked = cb.checked;
            hydrateDueDates();
            renderAll(false);
          };
        });

        // editable nodes
        body.querySelectorAll("[data-role]").forEach((node) => {
          const role = node.dataset.role;
          node.contentEditable = editMode ? "true" : "false";
          node.setAttribute("contenteditable", editMode ? "true" : "false");
          if (editMode) {
            node.classList.add("editable");
            node.onblur = () => applyEdit(node, role);
          } else {
            node.classList.remove("editable");
            node.onblur = null;
          }
        });

        body.querySelectorAll(".editHint").forEach((n) => {
          n.style.display = editMode ? "block" : "none";
        });
      }

      function applyEdit(node, role) {
        const gIdx = Number(node.dataset.g);
        const id = node.dataset.id;
        const group = DATA.roadmap[gIdx];
        if (!group) return;
        const task = group.tasks.find((x) => x.id === id);
        if (!task) return;

        const val = node.textContent.trim();

        if (role === "text") {
          task.text = val || task.text;
        } else if (role === "out") {
          task.out = val || task.out;
        } else if (role === "dueLabel") {
          task.dueLabel = val || task.dueLabel;
        } else if (role === "step") {
          const sIdx = Number(node.dataset.stepIdx);
          if (Number.isFinite(sIdx) && task.steps && task.steps[sIdx]) {
            task.steps[sIdx].label = val || task.steps[sIdx].label;
          }
        } else if (role === "id") {
          if (val && val !== task.id) {
            const exists = group.tasks.some((x) => x.id === val);
            if (!exists) task.id = val;
            else node.textContent = task.id;
          }
        }

        hydrateDueDates();
        renderAll(false);
      }

      /* =========================================================
   8) Macro <-> WBS sync
========================================================= */
      function setLensButtonsActive() {
        document.querySelectorAll(".seg button").forEach((b) => {
          b.classList.toggle("active", b.dataset.lens === lens);
        });
      }
      function setMacroChipsActive() {
        document.querySelectorAll("#macro-chips .chip").forEach((ch) => {
          ch.classList.toggle("on", ch.dataset.macro === macroView);
        });
      }
      function syncMacroFromLens() {
        if (lens === "year") {
          macroView = "ALL";
        } else if (lens === "half") {
          if (periodKey === "H1" || periodKey === "H2") macroView = periodKey;
        } else if (lens === "quarter") {
          if (["Q1", "Q2", "Q3", "Q4"].includes(periodKey))
            macroView = periodKey;
        }
        setMacroChipsActive();
      }
      function applyMacroView(view) {
        macroView = view;
        setMacroChipsActive();

        if (view === "ALL") {
          lens = "year";
          periodKey = String(YEAR);
        } else if (view === "H1" || view === "H2") {
          lens = "half";
          periodKey = view;
        } else if (["Q1", "Q2", "Q3", "Q4"].includes(view)) {
          lens = "quarter";
          periodKey = view;
        }

        setLensButtonsActive();
        buildPeriods();
        document.getElementById("period-select").value = periodKey;

        renderAll(false);
      }

      /* =========================================================
   9) Theme / Density
========================================================= */
      function applyTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem(UI_THEME_KEY, theme);
        const btn = document.getElementById("theme-btn");
        btn.textContent = theme === "light" ? "â˜€ï¸" : "ğŸŒ™";
      }
      function toggleTheme() {
        const current =
          document.documentElement.getAttribute("data-theme") || "dark";
        applyTheme(current === "dark" ? "light" : "dark");
      }
      function applyDensity(mode) {
        const body = document.body;
        if (mode === "compact") body.classList.add("compact");
        else body.classList.remove("compact");
        localStorage.setItem(UI_DENSITY_KEY, mode);
        const btn = document.getElementById("density-btn");
        btn.textContent = mode === "compact" ? "ê°€ë…ì„±: ë°€ë„" : "ê°€ë…ì„±: í¸ì•ˆ";
      }
      function toggleDensity() {
        const mode = localStorage.getItem(UI_DENSITY_KEY) || "comfortable";
        applyDensity(mode === "comfortable" ? "compact" : "comfortable");
      }

      /* =========================================================
   10) Controls (edit/save uses Google Sheet)
========================================================= */
      function setSavingState(isSaving) {
        const saveBtn = document.getElementById("save-btn");
        if (!saveBtn) return;
        saveBtn.disabled = isSaving;
        saveBtn.textContent = isSaving ? "ì €ì¥ì¤‘..." : "ì €ì¥";
      }

      function initControls() {
        document.querySelectorAll(".seg button").forEach((btn) => {
          btn.onclick = () => {
            lens = btn.dataset.lens;
            setLensButtonsActive();
            buildPeriods();
            syncMacroFromLens();
            renderAll();
          };
        });

        const ps = document.getElementById("period-select");
        ps.onchange = () => {
          periodKey = ps.value;
          syncMacroFromLens();
          renderAll();
        };

        const ss = document.getElementById("status-select");
        ss.onchange = () => {
          statusFilter = ss.value;
          renderAll();
        };

        const si = document.getElementById("search-input");
        si.oninput = () => {
          searchQuery = si.value || "";
          renderAll();
        };

        document.querySelectorAll("#macro-chips .chip").forEach((ch) => {
          ch.onclick = () => applyMacroView(ch.dataset.macro);
        });

        // Theme / density
        document.getElementById("theme-btn").onclick = toggleTheme;
        document.getElementById("density-btn").onclick = toggleDensity;

        // Edit controls
        const editBtn = document.getElementById("edit-btn");
        const saveBtn = document.getElementById("save-btn");
        const exitBtn = document.getElementById("exit-btn");
        const badge = document.getElementById("edit-badge");

        editBtn.onclick = () => {
          openPwModal((pw) => {
            if (pw !== EDIT_PASSWORD) {
              toast("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜", "bad");
              return;
            }
            EDIT_PIN_SESSION = pw; // âœ… ì €ì¥ ì‹œ ì„œë²„ ê²€ì¦ìš©
            editMode = true;

            badge.textContent = "EDITING";
            badge.classList.add("on");
            editBtn.style.display = "none";
            saveBtn.style.display = "inline-block";
            exitBtn.style.display = "inline-block";

            toast("í¸ì§‘ ëª¨ë“œ í™œì„±í™”", "good");
            renderAll(false);
          });
        };

        saveBtn.onclick = async () => {
          if (!editMode) {
            toast("ì½ê¸° ëª¨ë“œì—ì„œëŠ” ì €ì¥ ë¶ˆê°€", "bad");
            return;
          }
          if (!IS_GAS) {
            toast("Apps Script í™˜ê²½ì—ì„œë§Œ ì €ì¥ ê°€ëŠ¥", "bad");
            return;
          }
          try {
            setSavingState(true);
            const res = await saveToGoogle();
            if (res && res.ok) {
              toast("ì €ì¥ ì™„ë£Œ (Google Sheet)", "good");
            } else {
              toast(
                res?.error === "INVALID_PIN"
                  ? "ì €ì¥ ì‹¤íŒ¨: PIN ë¶ˆì¼ì¹˜"
                  : "ì €ì¥ ì‹¤íŒ¨",
                "bad",
              );
            }
          } catch (e) {
            toast("ì €ì¥ ì‹¤íŒ¨: ì„œë²„ í˜¸ì¶œ ì˜¤ë¥˜", "bad");
          } finally {
            setSavingState(false);
          }
        };

        exitBtn.onclick = () => {
          editMode = false;
          EDIT_PIN_SESSION = null;

          badge.textContent = "READ-ONLY";
          badge.classList.remove("on");
          editBtn.style.display = "inline-block";
          saveBtn.style.display = "none";
          exitBtn.style.display = "none";

          toast("í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ", "");
          renderAll(false);
        };
      }

      /* =========================================================
   11) Render all
========================================================= */
      function renderAll(rebuildPeriods = true) {
        hydrateDueDates();
        if (rebuildPeriods) buildPeriods();

        renderDeptChips();
        renderMacroTimeline();
        renderTotal();
        renderOverview();
        renderWBS();
      }

      /* Boot (Google load â†’ render) */
      (async function boot() {
        // Theme
        const savedTheme = localStorage.getItem(UI_THEME_KEY) || "dark";
        applyTheme(savedTheme);

        // Density
        const savedDensity =
          localStorage.getItem(UI_DENSITY_KEY) || "comfortable";
        applyDensity(savedDensity);

        if (!IS_GAS) {
          toast(
            "ê²½ê³ : Apps Script Web Appì—ì„œ ì‹¤í–‰í•´ì•¼ êµ¬ê¸€ ì €ì¥ì´ ë™ì‘í•¨",
            "bad",
          );
        }

        // âœ… 1) ì„œë²„ì—ì„œ ë¡œë“œ
        try {
          if (IS_GAS) await loadFromGoogle();
          else DATA = deepClone(DEFAULT_DATA);
        } catch (e) {
          DATA = deepClone(DEFAULT_DATA);
          toast("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ê¸°ë³¸ê°’ í‘œì‹œ", "bad");
        }

        // âœ… 2) ì´ˆê¸°í™”/ë Œë”
        hydrateDueDates();
        initControls();
        buildPeriods();
        syncMacroFromLens();
        setLensButtonsActive();
        setMacroChipsActive();
        renderAll(false);

        const ps = document.getElementById("period-select");
        if (ps) ps.value = periodKey;
      })();
    </script>
  </body>
</html>

ì´ê±° ì–´ë””ë‹¤ ë°”ê¿”ì•¼í•´ ìµ²ì˜¤ ã…—ì‹€
