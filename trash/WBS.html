<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>
      AITRICS 2026 | Step WBS + Auto Gantt + Export + Ops Action + Gov Template
    </title>

    <style>
      /* =====================================================
   DASHBOARD ALIGNMENT FIX (DESIGN ONLY)
   - ë‚´ìš© / ë°ì´í„° / JS âŒ ë³€ê²½ ì—†ìŒ(ê¸°ì¡´ ë¡œì§ ìœ ì§€)
   - ë‹¤ë§Œ, ìš´ì˜ Action Dashboard/Template íƒ­ ì¶”ê°€ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ í™•ì¥
===================================================== */

      :root {
        --bg: #f6f7fb;
        --surface: #ffffff;
        --surface-2: #f8fafc;
        --border: #e6e9f0;
        --text-p: #0f172a;
        --text-s: #6b7280;

        --data: #2563eb;
        --ai: #7c3aed;
        --svc: #db2777;
        --reg: #d97706;

        --done: #16a34a;
        --warn: #dc2626;

        --radius: 14px;
        --shadow-sm: 0 2px 6px rgba(15, 23, 42, 0.05);
        --shadow-md: 0 10px 28px rgba(15, 23, 42, 0.08);
      }

      /* ---------- BASE ---------- */
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 24px;
        background: linear-gradient(180deg, #f8fafc, #f3f4f6);
        color: var(--text-p);
        font-family:
          Inter,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          "Noto Sans KR",
          sans-serif;
      }
      .container {
        max-width: 1680px;
        margin: 0 auto;
      }

      /* ---------- HEADER ---------- */
      header {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 24px;
        padding: 20px 24px;
        background: #fff;
        border-radius: 18px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-md);
      }
      .title {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 900;
      }
      .sub {
        margin: 0;
        font-size: 12px;
        color: var(--text-s);
        line-height: 1.5;
      }
      .actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      /* ---------- BUTTON / BADGE ---------- */
      .btn {
        border: 1px solid var(--border);
        background: #fff;
        border-radius: 10px;
        padding: 8px 14px;
        font-size: 12px;
        font-weight: 700;
        cursor: pointer;
      }
      .btn.primary {
        border-color: rgba(37, 99, 235, 0.35);
        color: #1d4ed8;
      }
      .btn.danger {
        border-color: rgba(220, 38, 38, 0.35);
        color: #b91c1c;
      }
      .badge {
        font-size: 11px;
        font-weight: 800;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface-2);
        color: var(--text-s);
      }
      .badge.on {
        background: rgba(22, 163, 74, 0.12);
        border-color: rgba(22, 163, 74, 0.35);
        color: #065f46;
      }
      .badge.warn {
        background: rgba(251, 191, 36, 0.18);
        border-color: rgba(251, 191, 36, 0.45);
        color: #78350f;
      }

      /* ---------- KPI ---------- */
      .kpiBig {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }
      .kpiLabel {
        font-size: 11px;
        letter-spacing: 1px;
        color: var(--text-s);
        font-weight: 800;
      }
      .kpiVal {
        font-family: ui-monospace, Menlo, Consolas, monospace;
        font-size: 34px;
        font-weight: 900;
      }

      /* ---------- LAYOUT ---------- */
      .grid {
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 18px;
        margin-top: 20px;
      }
      @media (max-width: 1100px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      .panel {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: var(--shadow-sm);
      }
      .panelHead {
        padding: 14px 18px;
        border-bottom: 1px solid var(--border);
        background: #fafafa;
      }
      .panelTitle {
        font-size: 12px;
        font-weight: 900;
        color: var(--text-s);
        letter-spacing: 1px;
        display: flex;
        justify-content: space-between;
      }

      /* ---------- NAV ---------- */
      .tabs {
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding: 12px;
      }
      .tabBtn {
        display: flex;
        justify-content: space-between;
        padding: 10px 14px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 800;
        background: transparent;
        border: 1px solid transparent;
      }
      .tabBtn.active {
        background: rgba(37, 99, 235, 0.1);
        border-color: rgba(37, 99, 235, 0.25);
      }

      /* ---------- FILTER BAR (FIXED) ---------- */
      .row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        align-items: center;
      }
      .filters {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: nowrap;
      }
      .select,
      .input {
        height: 34px;
        padding: 0 10px;
        font-size: 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
      }
      .input {
        min-width: 260px;
      }

      /* ---------- DEPT CHIPS (FIXED POSITION) ---------- */
      .chips {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .chip {
        font-size: 11px;
        font-weight: 800;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #f8fafc;
      }
      .chip.on {
        background: rgba(37, 99, 235, 0.12);
        border-color: rgba(37, 99, 235, 0.35);
      }

      /* ---------- CONTENT ---------- */
      .content {
        padding: 18px;
      }
      .hr {
        height: 1px;
        background: var(--border);
        margin: 20px 0;
      }
      .small {
        font-size: 11px;
        color: var(--text-s);
      }
      .mono {
        font-family: ui-monospace, Menlo, Consolas, monospace;
      }

      /* ---------- DASHBOARD CARDS (FIX) ---------- */
      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
      }
      .pCard {
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px;
        background: #fff;
      }
      .pTop {
        display: flex;
        justify-content: space-between;
        gap: 12px;
      }
      .pName {
        font-size: 13.5px;
        font-weight: 900;
      }
      .pMeta {
        text-align: right;
        font-size: 11px;
        color: var(--text-s);
      }
      .pBar {
        margin-top: 12px;
        height: 8px;
        border-radius: 999px;
        background: #e5e7eb;
        overflow: hidden;
      }
      .pFill {
        height: 100%;
      }
      .pFoot {
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
      }

      /* ---------- RISK ---------- */
      .riskBadge {
        font-size: 10px;
        font-weight: 900;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(220, 38, 38, 0.4);
        background: rgba(220, 38, 38, 0.1);
        color: var(--warn);
      }

      /* ---------- NEW: OPS HIGHLIGHT ---------- */
      .stepRow {
        display: grid;
        grid-template-columns: 22px 90px 1fr 70px 110px 1.2fr;
        gap: 10px;
        align-items: center;
        padding: 10px 10px;
        border: 1px solid var(--border);
        border-radius: 12px;
        margin-top: 10px;
        background: #fff;
      }
      .cb {
        transform: translateY(1px);
      }
      .stepRow.dueSoon {
        border-color: rgba(251, 191, 36, 0.7);
        background: rgba(251, 191, 36, 0.12);
      }
      .stepRow.overdue {
        border-color: rgba(220, 38, 38, 0.65);
        background: rgba(220, 38, 38, 0.08);
      }
      .kTag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 10px;
        font-weight: 900;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface-2);
        color: var(--text-s);
      }
      .kTag.soon {
        border-color: rgba(251, 191, 36, 0.55);
        background: rgba(251, 191, 36, 0.15);
        color: #78350f;
      }
      .kTag.over {
        border-color: rgba(220, 38, 38, 0.55);
        background: rgba(220, 38, 38, 0.12);
        color: #7f1d1d;
      }

      /* ---------- NEW: TABLE ---------- */
      .tableWrap {
        overflow: auto;
        border: 1px solid var(--border);
        border-radius: 14px;
      }
      table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
        min-width: 980px;
      }
      th,
      td {
        border-bottom: 1px solid var(--border);
        padding: 10px 10px;
        font-size: 12px;
        vertical-align: top;
        background: #fff;
      }
      thead th {
        position: sticky;
        top: 0;
        background: #f8fafc;
        z-index: 1;
        font-weight: 900;
        color: var(--text-s);
      }
      .ganttCell {
        min-width: 44px;
        padding: 0 6px;
      }
      .gBar {
        height: 16px;
        border-radius: 10px;
        background: #e5e7eb;
      }

      /* ---------- NEW: WBS BLOCK STYLES (existing renderWBS expects these) ---------- */
      .taskBlock {
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 14px;
        margin: 14px 0 22px 0;
        background: #fff;
      }
      .taskHead {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: flex-start;
      }
      .taskTitle {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .taskLine {
        font-weight: 900;
      }
      .taskMeta {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .tag {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface-2);
        color: var(--text-s);
        font-weight: 800;
      }
      .cols {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 12px;
      }
      @media (max-width: 1100px) {
        .cols {
          grid-template-columns: 1fr;
        }
      }
      .box {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 12px;
        background: #fff;
      }
      .boxTitle {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        align-items: center;
        font-weight: 900;
        margin-bottom: 10px;
      }
      .clean {
        margin: 0;
        padding-left: 18px;
      }
      .pill {
        font-size: 11px;
        font-weight: 900;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--surface-2);
        color: var(--text-s);
      }
    </style>
  </head>

  <body>
    <div class="container" id="app" data-theme="dark">
      <header>
        <div class="title">
          <h1 class="h1">AITRICS 2026 Â· Step ê¸°ë°˜ WBS / Auto Gantt / Export</h1>
          <p class="sub">
            âœ… TaskëŠ” â€œí•´ì•¼ í•  ì¼(TODO) + ì‚°ì¶œë¬¼(Output)â€ì„ í¬í•¨ Â· ì§„í–‰ë¥ ì€ Step
            ê°€ì¤‘ì¹˜(%) ê¸°ë°˜ ìë™ ê³„ì‚° Â· Step ì™„ë£Œ ì‹œ ì™„ë£Œì¼ ìë™ ê¸°ë¡<br />
            ğŸ§  <b>ìš´ì˜ Action</b>: <b>2ì£¼ ë‚´ ë§ˆê°(ë˜ëŠ” ì§€ì—°) ë¯¸ì™„ Step</b> ìë™
            í•˜ì´ë¼ì´íŠ¸ Â· <b>Dept ê°„ ì˜ì¡´ì„± ì¶©ëŒ</b> ëª©ë¡ ì œê³µ<br />
            ğŸ›ï¸ <b>ê¸°ê´€ ì œì¶œ í…œí”Œë¦¿</b>: ì‹ì•½ì²˜/ì •ë¶€ R&amp;D ì œì¶œ ê´€í–‰ì— ë§ì¶˜
            ì»¬ëŸ¼ ì •ë ¬ Export ì œê³µ
          </p>
        </div>

        <div class="actions">
          <span class="badge" id="saveBadge">NOT SAVED</span>
          <button class="btn" id="themeBtn">Light</button>
          <button class="btn primary" id="saveBtn">ì €ì¥</button>
          <button class="btn danger" id="resetBtn">ì´ˆê¸°í™”</button>

          <div class="kpiBig">
            <div class="kpiLabel">TOTAL PROGRESS</div>
            <div class="kpiVal" id="totalPct">0%</div>
          </div>
        </div>
      </header>

      <div class="grid">
        <!-- LEFT NAV -->
        <aside class="panel">
          <div class="panelHead">
            <div class="panelTitle">
              NAVIGATION <span class="tabHint" id="hintText">Cards</span>
            </div>
          </div>
          <div class="tabs">
            <button class="tabBtn active" data-tab="dash">
              ìš”ì•½ ì¹´ë“œ <span class="tabHint">Dept/Task</span>
            </button>
            <button class="tabBtn" data-tab="gantt">
              Gantt <span class="tabHint">ì›”/ì£¼</span>
            </button>
            <button class="tabBtn" data-tab="wbs">
              WBS <span class="tabHint">Step ì²´í¬</span>
            </button>

            <!-- NEW: OPS ACTION -->
            <button class="tabBtn" data-tab="ops">
              ğŸ§  Action <span class="tabHint">2ì£¼/ì˜ì¡´ì„±</span>
            </button>

            <button class="tabBtn" data-tab="export">
              Export <span class="tabHint">ê¸°ê´€ ì œì¶œ</span>
            </button>

            <!-- NEW: GOV TEMPLATE -->
            <button class="tabBtn" data-tab="template">
              ğŸ›ï¸ Template <span class="tabHint">MFDS/R&amp;D</span>
            </button>
          </div>
        </aside>

        <!-- RIGHT CONTENT -->
        <main class="panel">
          <div class="panelHead">
            <div class="panelTitle" id="mainTitle">DASHBOARD</div>

            <div class="row">
              <div class="filters">
                <select class="select" id="deptSelect" title="Dept">
                  <option value="ALL">ì „ì²´ Dept</option>
                </select>

                <select class="select" id="statusSelect" title="ìƒíƒœ">
                  <option value="all">ì „ì²´</option>
                  <option value="open">ë¯¸ì™„</option>
                  <option value="done">ì™„ë£Œ</option>
                </select>

                <input
                  class="input"
                  id="searchInput"
                  placeholder="ê²€ìƒ‰: ID/Task/Step/ì‚°ì¶œë¬¼"
                  style="min-width: 260px"
                />
                <span class="badge" id="countBadge">0 items</span>
              </div>

              <div class="filters" id="ganttControls" style="display: none">
                <div
                  class="seg"
                  aria-label="gantt mode"
                  style="display: flex; gap: 6px"
                >
                  <button
                    class="active"
                    data-gmode="week"
                    style="
                      border: 1px solid var(--border);
                      border-radius: 10px;
                      padding: 8px 10px;
                      background: #fff;
                      font-size: 12px;
                      font-weight: 900;
                      cursor: pointer;
                    "
                  >
                    ì£¼
                  </button>
                  <button
                    data-gmode="month"
                    style="
                      border: 1px solid var(--border);
                      border-radius: 10px;
                      padding: 8px 10px;
                      background: #fff;
                      font-size: 12px;
                      font-weight: 900;
                      cursor: pointer;
                    "
                  >
                    ì›”
                  </button>
                </div>
              </div>
            </div>

            <div class="chips" id="deptChips"></div>

            <!-- NEW: OPS LEGEND (contextual helper) -->
            <div
              class="small"
              id="opsLegend"
              style="margin-top: 10px; display: none"
            >
              <span class="kTag soon">DUE â‰¤ 14D</span>
              <span class="kTag over">OVERDUE</span>
              Â· ê¸°ì¤€ì¼: <span class="mono" id="todayLabel"></span> Â· â€œ2ì£¼ ë‚´
              ë¯¸ì™„ Stepâ€ = <b>Step ì¢…ë£Œì¼ì´ ê¸°ì¤€ì¼ ~ ê¸°ì¤€ì¼+14ì¼</b> ë²”ìœ„ì´ë©°
              DONEì´ ì•„ë‹Œ í•­ëª© + (ì¢…ë£Œì¼ì´ ê³¼ê±°ë©´ OVERDUE)
            </div>
          </div>

          <div class="content">
            <section id="tab-dash"></section>
            <section id="tab-gantt" style="display: none"></section>
            <section id="tab-wbs" style="display: none"></section>

            <!-- NEW -->
            <section id="tab-ops" style="display: none"></section>

            <section id="tab-export" style="display: none"></section>

            <!-- NEW -->
            <section id="tab-template" style="display: none"></section>
          </div>
        </main>
      </div>
    </div>

    <script>
      /* =====================
        CONFIG / STORAGE
      ===================== */
      const YEAR = 2026;
      const STORAGE_KEY = "aitrics_2026_step_wbs_final_v1";

      const MONTHS = [
        "Jan",
        "Feb",
        "Mar",
        "Apr",
        "May",
        "Jun",
        "Jul",
        "Aug",
        "Sep",
        "Oct",
        "Nov",
        "Dec",
      ];
      const MONTH_MAP = {
        Jan: 0,
        Feb: 1,
        Mar: 2,
        Apr: 3,
        May: 4,
        Jun: 5,
        Jul: 6,
        Aug: 7,
        Sep: 8,
        Oct: 9,
        Nov: 10,
        Dec: 11,
      };
      const QUARTER_OF_MONTH = (mIdx) =>
        mIdx <= 2 ? "Q1" : mIdx <= 5 ? "Q2" : mIdx <= 8 ? "Q3" : "Q4";

      const pad2 = (n) => String(n).padStart(2, "0");
      const fmt = (d) => d.toISOString().slice(0, 10);

      /* =====================
        NEW: OPS WINDOW
        - ë¸Œë¼ìš°ì € ë¡œì»¬ íƒ€ì„ì¡´(Date) ê¸°ì¤€ (ìš´ì˜ í˜„ì¥ì—ì„œëŠ” KST ì‚¬ìš© ì „ì œ)
      ===================== */
      const OPS_DUE_DAYS = 14;

      function startOfDay(d) {
        const x = new Date(d);
        x.setHours(0, 0, 0, 0);
        return x;
      }
      function addDays(d, days) {
        const x = new Date(d);
        x.setDate(x.getDate() + days);
        return x;
      }
      function parseISODate(iso) {
        // iso: YYYY-MM-DD
        if (!iso) return null;
        const [y, m, dd] = iso.split("-").map(Number);
        if (!y || !m || !dd) return null;
        return new Date(y, m - 1, dd, 0, 0, 0, 0);
      }

      function stepDueStatus(step) {
        // returns: {status:'none'|'dueSoon'|'overdue', endISO, endDate}
        const r = weekToDateRange(step.week);
        if (!r.end) return { status: "none", endISO: "", endDate: null };
        const today = startOfDay(new Date());
        const endD = parseISODate(r.end);
        if (!endD) return { status: "none", endISO: r.end, endDate: null };
        const dueLimit = startOfDay(addDays(today, OPS_DUE_DAYS));
        if (step.done) return { status: "none", endISO: r.end, endDate: endD };

        if (endD < today)
          return { status: "overdue", endISO: r.end, endDate: endD };
        if (endD <= dueLimit)
          return { status: "dueSoon", endISO: r.end, endDate: endD };
        return { status: "none", endISO: r.end, endDate: endD };
      }

      /* =====================
        NEW: DEPENDENCIES (Dept ê°„ ì˜ì¡´ì„±)
        - â€œì…ë ¥ ë°ì´í„°/ì„ í–‰ ì‚°ì¶œë¬¼ì´ ì¤€ë¹„ë˜ì–´ì•¼ í›„í–‰ì´ ì°©ìˆ˜ ê°€ëŠ¥â€ ê´€ì 
        - ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ìš´ì˜íŒ€ì´ ì´ ë§¤í•‘ì„ í™•ì •/ìœ ì§€ê´€ë¦¬í•´ì•¼ í•¨(ì•„ë˜ëŠ” ê¸°ë³¸ ì´ˆì•ˆ)
      ===================== */
      const DEPENDENCIES = [
        {
          from: "DE-1",
          to: "AI-1",
          type: "Data Spec -> Model Design",
          note: "ì‹ í˜¸/ë³€ìˆ˜ ë²”ìœ„Â·ì „ì†¡Â·íŒŒì´í”„ë¼ì¸ ì„¤ê³„ ì„ í–‰ í•„ìš”",
        },
        {
          from: "DE-2",
          to: "AI-2",
          type: "Data Quality -> Evaluation",
          note: "ê²°ì¸¡/ì´ìƒì¹˜ ì •ì±… ë° ì²˜ë¦¬ ë¡œì§ ì—†ìœ¼ë©´ ì¬íƒí™˜ê²½ ì„±ëŠ¥ë³´ì • ì‹ ë¢°ë„ ì €í•˜",
        },
        {
          from: "DE-4",
          to: "SV-2",
          type: "Integration -> App",
          note: "T-Bridge/MDIP ì—°ê³„ ëª¨ë“ˆ ì†¡ìˆ˜ì‹  êµ¬í˜„/í…ŒìŠ¤íŠ¸ ì„ í–‰",
        },
        {
          from: "AI-1",
          to: "SV-2",
          type: "Model/Rules -> App",
          note: "íŒë‹¨/ì•Œë¦¼ ë¡œì§ ë° ëª¨ë¸ë§ ì„¤ê³„/ê²°ê³¼ ì—°ê³„ í•„ìš”",
        },
        {
          from: "SV-1",
          to: "SV-2",
          type: "User Research -> Backlog",
          note: "ì¸í„°ë·°/ìš”êµ¬ì‚¬í•­ ìš”ì•½ ê²°ê³¼ê°€ ì•± ë°±ë¡œê·¸ í™•ì •ì— ì˜í–¥",
        },
        {
          from: "AI-3",
          to: "RA-1",
          type: "Architecture -> PreConsult",
          note: "ì—­í• ë¶„ë¦¬/ì¶”ì ì„±/ì•ˆì „ ì„¤ê³„ê°€ ì‚¬ì „ìƒë‹´ í•µì‹¬ ê·¼ê±°",
        },
        {
          from: "RA-1",
          to: "RA-2",
          type: "PreConsult -> Submission",
          note: "ì‚¬ì „ìƒë‹´ ê²°ê³¼ ë°˜ì˜ í›„ ì¸í—ˆê°€ ìˆ˜í–‰ ì°©ìˆ˜ ê¶Œì¥",
        },
      ];

      /* =====================
        DEFAULT DATA (ì›ë³¸ ìœ ì§€)
      ===================== */
      const DEFAULT_DATA = {
        roadmap: [
          {
            dept: "ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§/ì—°ê³„",
            color: "var(--data)",
            tasks: [
              {
                id: "DE-1",
                title:
                  "ê°€ì •ìš© ì¸ê³µí˜¸í¡ê¸° ì‹ í˜¸ ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì†¡, ë¶„ì„ íŒŒì´í”„ë¼ì¸ ì„¤ê³„",
                todo: [
                  "ìˆ˜ì§‘ ì‹ í˜¸/ë³€ìˆ˜ ëª©ë¡ í™•ì •",
                  "ì „ì†¡ ë°©ì‹(ë°°ì¹˜/ìŠ¤íŠ¸ë¦¬ë°) ë° ì£¼ê¸° ì„¤ê³„",
                  "ë¶„ì„ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜ ì„¤ê³„",
                  "ì¥ì• /ëˆ„ë½/ì¬ì²˜ë¦¬ ì •ì±… ì •ì˜",
                  "ì„¤ê³„ ë¬¸ì„œ íŒ¨í‚¤ì§•",
                ],
                outputs: [
                  "Signal_Spec.xlsx",
                  "Transport_Design.md",
                  "Pipeline_Architecture.drawio",
                  "Retry_Policy.md",
                  "Pipeline_Design_Package.pdf",
                ],
                steps: [
                  {
                    week: "Feb W1",
                    label: "ìˆ˜ì§‘ ì‹ í˜¸/ë³€ìˆ˜ ë²”ìœ„ ì •ì˜",
                    weight: 15,
                    done: false,
                    doneAt: null,
                    outputs: ["Signal_Spec.xlsx"],
                  },
                  {
                    week: "Feb W2",
                    label: "ë°ì´í„° ì „ì†¡ ë°©ì‹Â·ì£¼ê¸° ì„¤ê³„",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Transport_Design.md"],
                  },
                  {
                    week: "Mar W1",
                    label: "ë¶„ì„ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜ ì„¤ê³„",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Pipeline_Architecture.drawio"],
                  },
                  {
                    week: "Mar W2",
                    label: "ì¥ì• /ëˆ„ë½/ì¬ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜",
                    weight: 25,
                    done: false,
                    doneAt: null,
                    outputs: ["Retry_Policy.md"],
                  },
                  {
                    week: "Mar W3",
                    label: "ì„¤ê³„ ë¬¸ì„œ íŒ¨í‚¤ì§•(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Pipeline_Design_Package.pdf"],
                  },
                ],
              },
              {
                id: "DE-2",
                title: "ê°€ì •ìš© ì¸ê³µí˜¸í¡ê¸° ë°ì´í„° ê²°ì¸¡ê°’ ë° ì´ìƒì¹˜ ì²˜ë¦¬",
                todo: [
                  "ê²°ì¸¡/ì´ìƒì¹˜ ê¸°ì¤€ ì •ì˜",
                  "ì²˜ë¦¬ ì •ì±…(ì œê±°/ë³´ê°„/í”Œë˜ê·¸) ì„¤ê³„",
                  "íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬ ë¡œì§ êµ¬í˜„",
                  "ìƒ˜í”Œ ê²€ì¦ ë° íŠœë‹",
                  "ê·œì¹™ ë¬¸ì„œí™” ë° ìš´ì˜ ê°€ì´ë“œ ì‘ì„±",
                ],
                outputs: [
                  "Missing_Outlier_Criteria.md",
                  "Cleaning_Policy.md",
                  "Cleaning_Module.py",
                  "Validation_Report.pdf",
                  "Cleaning_Guide.pdf",
                ],
                steps: [
                  {
                    week: "Mar W1",
                    label: "ê²°ì¸¡/ì´ìƒì¹˜ ê¸°ì¤€ ì •ì˜",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Missing_Outlier_Criteria.md"],
                  },
                  {
                    week: "Mar W2",
                    label: "ì²˜ë¦¬ ì •ì±… ì„¤ê³„",
                    weight: 25,
                    done: false,
                    doneAt: null,
                    outputs: ["Cleaning_Policy.md"],
                  },
                  {
                    week: "Apr W1",
                    label: "ì²˜ë¦¬ ë¡œì§ íŒŒì´í”„ë¼ì¸ ë°˜ì˜(ê°œë°œ)",
                    weight: 35,
                    done: false,
                    doneAt: null,
                    outputs: ["Cleaning_Module.py"],
                  },
                  {
                    week: "Apr W2",
                    label: "ìƒ˜í”Œ ê²€ì¦ ë° íŠœë‹(ì‹œí—˜)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Validation_Report.pdf"],
                  },
                  {
                    week: "Apr W3",
                    label: "ì²˜ë¦¬ ê·œì¹™ ë¬¸ì„œí™”(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Cleaning_Guide.pdf"],
                  },
                ],
              },
              {
                id: "DE-3",
                title: "PRO ì„¤ë¬¸ ë°ì´í„° êµ¬ì¡° ì„¤ê³„ ë° ê¸°íš",
                todo: [
                  "PRO í•­ëª© í›„ë³´ ì •ì˜",
                  "ë°ì´í„° ìŠ¤í‚¤ë§ˆ/ì½”ë“œë¶ ì„¤ê³„",
                  "ìˆ˜ì§‘ ì£¼ê¸° ë° ì—°ê³„ í¬ì¸íŠ¸ ì •ì˜",
                  "API/ì €ì¥ êµ¬ì¡° í™•ì •",
                  "ëª…ì„¸ ë° ìš´ì˜ ë¬¸ì„œí™”",
                ],
                outputs: [
                  "PRO_Item_List.xlsx",
                  "PRO_Schema.json",
                  "PRO_Collection_Plan.md",
                  "PRO_API_Spec.yaml",
                  "PRO_Spec_Package.pdf",
                ],
                steps: [
                  {
                    week: "Mar W1",
                    label: "PRO í•­ëª© í›„ë³´ ì •ì˜",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["PRO_Item_List.xlsx"],
                  },
                  {
                    week: "Mar W2",
                    label: "ë°ì´í„° êµ¬ì¡°/ìŠ¤í‚¤ë§ˆ ì„¤ê³„",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["PRO_Schema.json"],
                  },
                  {
                    week: "Apr W1",
                    label: "ìˆ˜ì§‘ ì£¼ê¸°Â·ì—°ê³„ í¬ì¸íŠ¸ ì •ì˜",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["PRO_Collection_Plan.md"],
                  },
                  {
                    week: "Apr W2",
                    label: "API/ì €ì¥ êµ¬ì¡° ì •ë¦¬",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["PRO_API_Spec.yaml"],
                  },
                  {
                    week: "Apr W3",
                    label: "ëª…ì„¸ ë¬¸ì„œí™”(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["PRO_Spec_Package.pdf"],
                  },
                ],
              },
              {
                id: "DE-4",
                title:
                  "T-Bridge, MDIP ì—°ê³„ ëª¨ë“ˆ ë°ì´í„° ì†¡/ìˆ˜ì‹  íŒŒì´í”„ë¼ì¸ ì„¤ê³„&ê°œë°œ",
                todo: [
                  "ì™¸ë¶€ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ì •ë¦¬",
                  "ì†¡/ìˆ˜ì‹  ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„",
                  "íŒŒì´í”„ë¼ì¸ êµ¬í˜„",
                  "í†µí•© í…ŒìŠ¤íŠ¸ ë° ì˜ˆì™¸ì²˜ë¦¬",
                  "ìš´ì˜/ëª…ì„¸ ë¬¸ì„œ ì •ë¦¬",
                ],
                outputs: [
                  "Integration_Requirements.md",
                  "Integration_Interface_Spec.yaml",
                  "Integration_Pipeline_Service.zip",
                  "Integration_Test_Report.pdf",
                  "Integration_Runbook.pdf",
                ],
                steps: [
                  {
                    week: "Feb W3",
                    label: "ì™¸ë¶€ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ì •ë¦¬",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Integration_Requirements.md"],
                  },
                  {
                    week: "Mar W1",
                    label: "ì†¡Â·ìˆ˜ì‹  ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Integration_Interface_Spec.yaml"],
                  },
                  {
                    week: "Mar W2",
                    label: "íŒŒì´í”„ë¼ì¸ êµ¬í˜„(ê°œë°œ)",
                    weight: 40,
                    done: false,
                    doneAt: null,
                    outputs: ["Integration_Pipeline_Service.zip"],
                  },
                  {
                    week: "Apr W1",
                    label: "í†µí•© í…ŒìŠ¤íŠ¸Â·ì˜ˆì™¸ ì²˜ë¦¬(ì‹œí—˜)",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Integration_Test_Report.pdf"],
                  },
                  {
                    week: "Apr W2",
                    label: "ìš´ì˜/ëª…ì„¸ ë¬¸ì„œ ì •ë¦¬(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Integration_Runbook.pdf"],
                  },
                ],
              },
            ],
          },
          {
            dept: "AI ì•Œê³ ë¦¬ì¦˜/ëª¨ë¸ ê°œë°œ",
            color: "var(--ai)",
            tasks: [
              {
                id: "AI-1",
                title: "ê°€ì •ìš© ì¸ê³µí˜¸í¡ê¸° ì‹ í˜¸ ëª¨ë‹ˆí„°ë§ ì¸ê³µì§€ëŠ¥ ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„",
                todo: [
                  "ë¬¸ì œ ì •ì˜ ë° í‰ê°€ì§€í‘œ í™•ì •",
                  "ì…ë ¥ í”¼ì²˜/ì‹ í˜¸ í‘œí˜„ ì •ì˜",
                  "ëª¨ë¸ë§ êµ¬ì¡°(ë² ì´ìŠ¤ë¼ì¸/ê³ ë„í™”) ì„¤ê³„",
                  "ì•Œë¦¼/íŒë‹¨ ë¡œì§ ì„¤ê³„",
                  "ì„¤ê³„ ë¬¸ì„œí™”",
                ],
                outputs: [
                  "Problem_Definition.md",
                  "Feature_Spec.md",
                  "Model_Architecture.drawio",
                  "Decision_Rules.md",
                  "AI_Design_Package.pdf",
                ],
                steps: [
                  {
                    week: "Mar W1",
                    label: "ë¬¸ì œ ì •ì˜Â·í‰ê°€ì§€í‘œ ì„¤ì •",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Problem_Definition.md"],
                  },
                  {
                    week: "Mar W2",
                    label: "ì…ë ¥ í”¼ì²˜/ì‹ í˜¸ í‘œí˜„ ì„¤ê³„",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Feature_Spec.md"],
                  },
                  {
                    week: "Apr W1",
                    label: "ëª¨ë¸ë§ ì „ëµÂ·êµ¬ì¡° ì„¤ê³„",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Model_Architecture.drawio"],
                  },
                  {
                    week: "Apr W2",
                    label: "íŒë‹¨/ì•Œë¦¼ ë¡œì§ ì„¤ê³„",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Decision_Rules.md"],
                  },
                  {
                    week: "Apr W3",
                    label: "ì„¤ê³„ ë¬¸ì„œí™”(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["AI_Design_Package.pdf"],
                  },
                ],
              },
              {
                id: "AI-2",
                title:
                  "ì•Œê³ ë¦¬ì¦˜ ì„±ëŠ¥ í‰ê°€ ë° ì¬íƒ í™˜ê²½ ì í•©ì„± í™•ë³´ë¥¼ ìœ„í•œ ëª¨ë¸ ì„±ëŠ¥ ë³´ì •",
                todo: [
                  "í‰ê°€ ì‹œë‚˜ë¦¬ì˜¤/ë°ì´í„°ì…‹ ì •ì˜",
                  "1ì°¨ ì„±ëŠ¥ í‰ê°€ ìˆ˜í–‰",
                  "ì¬íƒ í™˜ê²½ ë°˜ì˜ ë³´ì •(ë…¸ì´ì¦ˆ/ê²°ì¸¡/ì„¼ì„œë³€ë™)",
                  "ì¬í‰ê°€ ë° íŠœë‹",
                  "í‰ê°€ ë³´ê³ ì„œ ì‘ì„±",
                ],
                outputs: [
                  "Eval_Plan.md",
                  "Baseline_Eval_Report.pdf",
                  "Calibration_Patch.ipynb",
                  "Tuning_Log.csv",
                  "Final_Eval_Report.pdf",
                ],
                steps: [
                  {
                    week: "May W1",
                    label: "í‰ê°€ ì‹œë‚˜ë¦¬ì˜¤Â·ë°ì´í„°ì…‹ ì •ì˜",
                    weight: 15,
                    done: false,
                    doneAt: null,
                    outputs: ["Eval_Plan.md"],
                  },
                  {
                    week: "May W2",
                    label: "1ì°¨ ì„±ëŠ¥ í‰ê°€(ì‹œí—˜)",
                    weight: 25,
                    done: false,
                    doneAt: null,
                    outputs: ["Baseline_Eval_Report.pdf"],
                  },
                  {
                    week: "Jun W1",
                    label: "ì¬íƒ í™˜ê²½ ë°˜ì˜ ë³´ì •(ê°œë°œ)",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Calibration_Patch.ipynb"],
                  },
                  {
                    week: "Jun W2",
                    label: "ì„±ëŠ¥ ì¬í‰ê°€Â·íŠœë‹(ì‹œí—˜)",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Tuning_Log.csv"],
                  },
                  {
                    week: "Jun W3",
                    label: "í‰ê°€ ë³´ê³ ì„œ(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Final_Eval_Report.pdf"],
                  },
                ],
              },
              {
                id: "AI-3",
                title: "ì—­í•  ë¶„ë¦¬í˜• ë‹¤ì¤‘ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° AI ì‹œìŠ¤í…œ ì„¤ê³„",
                todo: [
                  "ì—­í•  ë¶„ë¦¬ ê¸°ì¤€ ì •ì˜",
                  "ì»´í¬ë„ŒíŠ¸ I/O ë° ê²½ê³„ ì •ì˜",
                  "ë¡œê·¸/ì¶”ì ì„± ì„¤ê³„",
                  "ì•ˆì „Â·ì¸í—ˆê°€ ê´€ì  ì„¤ê³„ ì ê²€",
                  "ì•„í‚¤í…ì²˜ ë¬¸ì„œí™”",
                ],
                outputs: [
                  "Role_Split_Criteria.md",
                  "Component_IO_Spec.yaml",
                  "Traceability_Log_Schema.json",
                  "Safety_Review.md",
                  "System_Architecture_Package.pdf",
                ],
                steps: [
                  {
                    week: "Apr W1",
                    label: "ì—­í•  ë¶„ë¦¬ ê¸°ì¤€ ì •ì˜",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Role_Split_Criteria.md"],
                  },
                  {
                    week: "Apr W2",
                    label: "ì»´í¬ë„ŒíŠ¸ ê°„ I/O ì„¤ê³„",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Component_IO_Spec.yaml"],
                  },
                  {
                    week: "May W1",
                    label: "ë¡œê·¸Â·ì¶”ì ì„± ì„¤ê³„",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Traceability_Log_Schema.json"],
                  },
                  {
                    week: "May W2",
                    label: "ì•ˆì „Â·ì¸í—ˆê°€ ê´€ì  ê²€í† ",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Safety_Review.md"],
                  },
                  {
                    week: "May W3",
                    label: "ì•„í‚¤í…ì²˜ ë¬¸ì„œ(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["System_Architecture_Package.pdf"],
                  },
                ],
              },
            ],
          },
          {
            dept: "ì„œë¹„ìŠ¤ ê°œë°œ/êµ¬í˜„",
            color: "var(--svc)",
            tasks: [
              {
                id: "SV-1",
                title:
                  "ì†Œì•„í˜¸í¡ë¶€ì „ íŠ¹í™” ì§ˆì˜Â·ì‘ë‹µ ì±—ë´‡ + íŠ¸ë¦¬ì•„ì œ ëª¨ë“ˆ ê°œë°œ ìœ„í•œ ì „ë¬¸ê°€ ìë¬¸ ë° ì‚¬ìš©ì ì¸í„°ë·°",
                todo: [
                  "ëŒ€ìƒì/ì „ë¬¸ê°€ ë¦¬ìŠ¤íŠ¸ì—… ë° ì„­ì™¸",
                  "ì¸í„°ë·° ê°€ì´ë“œ/ì§ˆë¬¸ì§€ ì„¤ê³„",
                  "ì¸í„°ë·°/ìë¬¸ ìˆ˜í–‰",
                  "ì¸ì‚¬ì´íŠ¸ ì •ë¦¬ ë° ìš”êµ¬ì‚¬í•­ ë°˜ì˜",
                  "ê²°ê³¼ ë³´ê³ ì„œ ì‘ì„±",
                ],
                outputs: [
                  "Interview_Target_List.xlsx",
                  "Interview_Guide.docx",
                  "Interview_Notes.pdf",
                  "Requirements_Summary.md",
                  "FGI_Report.pdf",
                ],
                steps: [
                  {
                    week: "Mar W2",
                    label: "ëŒ€ìƒì/ì „ë¬¸ê°€ ì„ ì •",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Interview_Target_List.xlsx"],
                  },
                  {
                    week: "Mar W3",
                    label: "ì¸í„°ë·° ê°€ì´ë“œ ì„¤ê³„",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Interview_Guide.docx"],
                  },
                  {
                    week: "Apr W1",
                    label: "ì¸í„°ë·°Â·ìë¬¸ ìˆ˜í–‰",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Interview_Notes.pdf"],
                  },
                  {
                    week: "Apr W2",
                    label: "ì¸ì‚¬ì´íŠ¸ ì •ë¦¬Â·ìš”êµ¬ì‚¬í•­ ë°˜ì˜",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Requirements_Summary.md"],
                  },
                  {
                    week: "Apr W3",
                    label: "ê²°ê³¼ ë¬¸ì„œ(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["FGI_Report.pdf"],
                  },
                ],
              },
              {
                id: "SV-2",
                title: "ëª¨ë°”ì¼ ì•± ê¸°ëŠ¥ ê°œë°œ",
                todo: [
                  "ê¸°ëŠ¥ ì •ì˜/ë°±ë¡œê·¸ í™•ì •",
                  "í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„",
                  "ë°ì´í„°/AI ì—°ê³„ êµ¬í˜„",
                  "QA ë° ì‚¬ìš©ì„± ê°œì„ ",
                  "ë¦´ë¦¬ì¦ˆ/ìš´ì˜ ë¬¸ì„œí™”",
                ],
                outputs: [
                  "App_Backlog.xlsx",
                  "App_Core_Features.apk",
                  "App_Data_AI_Integration.md",
                  "QA_Test_Report.pdf",
                  "Release_Runbook.pdf",
                ],
                steps: [
                  {
                    week: "May W1",
                    label: "ê¸°ëŠ¥ ì •ì˜Â·ë°±ë¡œê·¸ í™•ì •",
                    weight: 15,
                    done: false,
                    doneAt: null,
                    outputs: ["App_Backlog.xlsx"],
                  },
                  {
                    week: "May W2",
                    label: "í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„(ê°œë°œ)",
                    weight: 40,
                    done: false,
                    doneAt: null,
                    outputs: ["App_Core_Features.apk"],
                  },
                  {
                    week: "Jun W1",
                    label: "ë°ì´í„°Â·AI ì—°ê³„(ê°œë°œ)",
                    weight: 25,
                    done: false,
                    doneAt: null,
                    outputs: ["App_Data_AI_Integration.md"],
                  },
                  {
                    week: "Jun W2",
                    label: "QAÂ·ì‚¬ìš©ì„± ê°œì„ (ì‹œí—˜)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["QA_Test_Report.pdf"],
                  },
                  {
                    week: "Jun W3",
                    label: "ë¦´ë¦¬ì¦ˆ/ìš´ì˜ ë¬¸ì„œ(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Release_Runbook.pdf"],
                  },
                ],
              },
            ],
          },
          {
            dept: "ì¸í—ˆê°€",
            color: "var(--reg)",
            tasks: [
              {
                id: "RA-1",
                title: "ë””ì§€í„¸ ì˜ë£Œê¸°ê¸° ì¸í—ˆê°€ ì‚¬ì „ìƒë‹´",
                todo: [
                  "ì˜ë„ëœ ì‚¬ìš©/ì‚¬ìš©ì/ì¶œë ¥ ì •ì˜",
                  "ê¸°ëŠ¥ë¶„ë¦¬ ë° ë¦¬ìŠ¤í¬ ìš”ì•½",
                  "ì‚¬ì „ìƒë‹´ ìë£Œ íŒ¨í‚¤ì§•",
                  "ìƒë‹´ ê²°ê³¼ ì •ë¦¬ ë° ë°˜ì˜",
                ],
                outputs: [
                  "Intended_Use_Statement.docx",
                  "Functional_Segmentation_Risk_Summary.pdf",
                  "PreConsult_Package.zip",
                  "PreConsult_Minutes.pdf",
                ],
                steps: [
                  {
                    week: "Mar W1",
                    label: "ì˜ë„ëœ ì‚¬ìš©Â·ì¶œë ¥ ì •ì˜",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Intended_Use_Statement.docx"],
                  },
                  {
                    week: "Mar W2",
                    label: "ê¸°ëŠ¥ë¶„ë¦¬Â·ë¦¬ìŠ¤í¬ ì •ë¦¬",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Functional_Segmentation_Risk_Summary.pdf"],
                  },
                  {
                    week: "Mar W3",
                    label: "ì‚¬ì „ìƒë‹´ ìë£Œ íŒ¨í‚¤ì§•",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["PreConsult_Package.zip"],
                  },
                  {
                    week: "Mar W4",
                    label: "ê²°ê³¼ ì •ë¦¬ ë¬¸ì„œ(ë¬¸ì„œ)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["PreConsult_Minutes.pdf"],
                  },
                ],
              },
              {
                id: "RA-2",
                title: "ë””ì§€í„¸ ì˜ë£Œê¸°ê¸° ì¸í—ˆê°€ ìˆ˜í–‰",
                todo: [
                  "ê¸°ìˆ ë¬¸ì„œ/QMS í™•ì •",
                  "ì„±ëŠ¥/ìœ„í—˜ê´€ë¦¬/ì‚¬ìš©ì í•©ì„± ìë£Œ ì‘ì„±",
                  "ì œì¶œë³¸ QA ë° ê°­ í´ë¡œì§•",
                  "ì œì¶œ ë° ë³´ì™„ ëŒ€ì‘",
                  "ìµœì¢… ë¬¸ì„œ ì •ë¦¬ ë° ì•„ì¹´ì´ë¹™",
                ],
                outputs: [
                  "TechFile_QMS_Freeze.zip",
                  "Performance_Risk_Usability_Package.zip",
                  "Submission_QA_Checklist.xlsx",
                  "Submission_Logs.pdf",
                  "Final_Archive.zip",
                ],
                steps: [
                  {
                    week: "Jul W1",
                    label: "ê¸°ìˆ ë¬¸ì„œÂ·QMS í™•ì •",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["TechFile_QMS_Freeze.zip"],
                  },
                  {
                    week: "Aug W1",
                    label: "ì„±ëŠ¥Â·ìœ„í—˜ê´€ë¦¬ ìë£Œ ì‘ì„±(ê·¼ê±°/ë¬¸ì„œ)",
                    weight: 30,
                    done: false,
                    doneAt: null,
                    outputs: ["Performance_Risk_Usability_Package.zip"],
                  },
                  {
                    week: "Sep W1",
                    label: "ì œì¶œë³¸ QAÂ·ê°­ í´ë¡œì§•(ê²€í† )",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Submission_QA_Checklist.xlsx"],
                  },
                  {
                    week: "Oct W1",
                    label: "ì œì¶œÂ·ë³´ì™„ ëŒ€ì‘",
                    weight: 20,
                    done: false,
                    doneAt: null,
                    outputs: ["Submission_Logs.pdf"],
                  },
                  {
                    week: "Dec W2",
                    label: "ìµœì¢… ë¬¸ì„œ ì •ë¦¬(ì•„ì¹´ì´ë¹™)",
                    weight: 10,
                    done: false,
                    doneAt: null,
                    outputs: ["Final_Archive.zip"],
                  },
                ],
              },
            ],
          },
        ],
      };

      /* =====================
        STATE
      ===================== */
      let DATA = loadData();
      let activeTab = "dash";
      let viewDept = "ALL";
      let statusFilter = "all";
      let searchQuery = "";
      let ganttMode = "week"; // week | month
      let theme = loadTheme(); // dark | light

      applyTheme(theme);

      /* =====================
        STORAGE
      ===================== */
      function loadData() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return structuredClone(DEFAULT_DATA);
          return JSON.parse(raw);
        } catch (e) {
          return structuredClone(DEFAULT_DATA);
        }
      }
      function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));
        markSaved();
      }
      function resetData() {
        DATA = structuredClone(DEFAULT_DATA);
        localStorage.removeItem(STORAGE_KEY);
        markDirty("RESET");
        renderAll();
      }

      function loadTheme() {
        try {
          return localStorage.getItem(STORAGE_KEY + "_theme") || "dark";
        } catch {
          return "dark";
        }
      }
      function saveTheme(t) {
        try {
          localStorage.setItem(STORAGE_KEY + "_theme", t);
        } catch {}
      }

      function markSaved() {
        const b = document.getElementById("saveBadge");
        const now = new Date();
        b.textContent = `SAVED ${pad2(now.getHours())}:${pad2(now.getMinutes())}`;
        b.classList.remove("warn");
        b.classList.add("on");
      }
      function markDirty(label = "NOT SAVED") {
        const b = document.getElementById("saveBadge");
        b.textContent = label;
        b.classList.remove("on");
        b.classList.add("warn");
      }

      /* =====================
        DATE UTILS
      ===================== */
      function firstMondayOfMonth(year, monthIdx) {
        const d = new Date(year, monthIdx, 1);
        const day = d.getDay(); // 0=Sun,1=Mon
        const diff = day === 0 ? 1 : day === 1 ? 0 : 8 - day;
        d.setDate(d.getDate() + diff);
        return d;
      }

      function weekToDateRange(weekLabel) {
        if (!weekLabel)
          return {
            start: "",
            end: "",
            year: YEAR,
            month: "",
            quarter: "",
            week: "",
          };
        const m = weekLabel.match(/^([A-Za-z]{3})\s+W(\d)$/);
        if (!m)
          return {
            start: "",
            end: "",
            year: YEAR,
            month: "",
            quarter: "",
            week: weekLabel,
          };

        const mon = m[1];
        const w = Number(m[2]);
        const monthIdx = MONTH_MAP[mon];
        const firstMon = firstMondayOfMonth(YEAR, monthIdx);

        const start = new Date(firstMon);
        start.setDate(firstMon.getDate() + (w - 1) * 7);

        const end = new Date(start);
        end.setDate(start.getDate() + 4); // Fri

        return {
          year: YEAR,
          quarter: QUARTER_OF_MONTH(monthIdx),
          month: `${YEAR}-${pad2(monthIdx + 1)}`,
          week: weekLabel,
          start: fmt(start),
          end: fmt(end),
        };
      }

      function taskDateRange(task) {
        const ranges = task.steps
          .map((s) => weekToDateRange(s.week))
          .filter((r) => r.start && r.end);
        if (ranges.length === 0) return { start: "", end: "" };

        const start = ranges.reduce(
          (min, r) => (r.start < min ? r.start : min),
          ranges[0].start,
        );
        const end = ranges.reduce(
          (max, r) => (r.end > max ? r.end : max),
          ranges[0].end,
        );
        return { start, end };
      }

      /* =====================
        PROGRESS UTILS (weight-based)
      ===================== */
      function normalizeWeights(task) {
        const sum = task.steps.reduce((s, x) => s + (Number(x.weight) || 0), 0);
        if (sum === 100 || sum === 0) return;
        const scaled = task.steps.map((s) =>
          Math.round((s.weight / sum) * 100),
        );
        const diff = 100 - scaled.reduce((a, b) => a + b, 0);
        scaled[scaled.length - 1] += diff;
        task.steps.forEach((s, i) => (s.weight = scaled[i]));
      }
      function taskProgress(task) {
        normalizeWeights(task);
        const done = task.steps
          .filter((s) => s.done)
          .reduce((sum, s) => sum + (s.weight || 0), 0);
        return Math.round(done);
      }
      function deptProgress(group) {
        const total = group.tasks.length * 100;
        const done = group.tasks.reduce((sum, t) => sum + taskProgress(t), 0);
        return Math.round(total ? (done / total) * 100 : 0);
      }
      function totalProgress() {
        const totalTasks = DATA.roadmap.reduce(
          (sum, g) => sum + g.tasks.length,
          0,
        );
        const doneWeighted = DATA.roadmap.reduce(
          (sum, g) => sum + g.tasks.reduce((s, t) => s + taskProgress(t), 0),
          0,
        );
        return Math.round(
          totalTasks ? (doneWeighted / (totalTasks * 100)) * 100 : 0,
        );
      }

      /* =====================
        FILTERS
      ===================== */
      function matchesSearch(hay, q) {
        if (!q) return true;
        return hay.toLowerCase().includes(q.toLowerCase());
      }
      function stepHasOutputs(step) {
        return Array.isArray(step.outputs) && step.outputs.length > 0;
      }

      function groupFilter() {
        return viewDept === "ALL"
          ? DATA.roadmap
          : DATA.roadmap.filter((g) => g.dept === viewDept);
      }

      function taskPasses(t, g) {
        const pct = taskProgress(t);
        const isDone = pct === 100;

        if (statusFilter === "done" && !isDone) return false;
        if (statusFilter === "open" && isDone) return false;

        const hay = [
          g.dept,
          t.id,
          t.title,
          ...(t.todo || []),
          ...(t.outputs || []),
          ...t.steps.flatMap((s) => [s.week, s.label, ...(s.outputs || [])]),
        ].join(" ");
        if (!matchesSearch(hay, searchQuery)) return false;

        return true;
      }

      /* =====================
        YEAR-END RISK (Dec unfinished)
      ===================== */
      function isYearEndUnfinished(task) {
        const pct = taskProgress(task);
        if (pct === 100) return false;
        return task.steps.some((s) => {
          const r = weekToDateRange(s.week);
          return r.month?.endsWith("-12");
        });
      }

      /* =====================
        UI WIREUP
      ===================== */
      document.querySelectorAll(".tabBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".tabBtn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          activeTab = btn.dataset.tab;

          const hintText = document.getElementById("hintText");
          const mainTitle = document.getElementById("mainTitle");
          const ganttControls = document.getElementById("ganttControls");
          const opsLegend = document.getElementById("opsLegend");

          if (activeTab === "dash") {
            hintText.textContent = "Cards";
            mainTitle.textContent = "DASHBOARD";
          }
          if (activeTab === "gantt") {
            hintText.textContent = "Timeline";
            mainTitle.textContent = "GANTT";
          }
          if (activeTab === "wbs") {
            hintText.textContent = "Execution";
            mainTitle.textContent = "WBS";
          }
          if (activeTab === "ops") {
            hintText.textContent = "Action";
            mainTitle.textContent = "OPS ACTION";
          }
          if (activeTab === "export") {
            hintText.textContent = "Flatten";
            mainTitle.textContent = "EXPORT";
          }
          if (activeTab === "template") {
            hintText.textContent = "Gov";
            mainTitle.textContent = "GOV TEMPLATE";
          }

          ganttControls.style.display = activeTab === "gantt" ? "flex" : "none";
          opsLegend.style.display = activeTab === "ops" ? "block" : "none";

          // ê¸°ì¤€ì¼ í‘œê¸°(ìš´ì˜ Actionì—ë§Œ)
          if (activeTab === "ops") {
            const t = startOfDay(new Date());
            document.getElementById("todayLabel").textContent = fmt(t);
          }

          renderAll();
        });
      });

      document.getElementById("deptSelect").addEventListener("change", (e) => {
        viewDept = e.target.value;
        renderAll();
      });
      document
        .getElementById("statusSelect")
        .addEventListener("change", (e) => {
          statusFilter = e.target.value;
          renderAll();
        });
      document.getElementById("searchInput").addEventListener("input", (e) => {
        searchQuery = e.target.value || "";
        renderAll();
      });

      // gantt mode seg
      document.querySelectorAll(".seg button").forEach((b) => {
        b.addEventListener("click", () => {
          document
            .querySelectorAll(".seg button")
            .forEach((x) => x.classList.remove("active"));
          b.classList.add("active");
          ganttMode = b.dataset.gmode;
          renderAll();
        });
      });

      document.getElementById("saveBtn").addEventListener("click", () => {
        saveData();
      });
      document.getElementById("resetBtn").addEventListener("click", () => {
        if (
          confirm("ì´ˆê¸°í™”í•˜ë©´ ì²´í¬/ë‚ ì§œ ê¸°ë¡ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì´ˆê¸°í™”í• ê¹Œìš”?")
        )
          resetData();
      });

      document.getElementById("themeBtn").addEventListener("click", () => {
        theme = theme === "dark" ? "light" : "dark";
        applyTheme(theme);
        saveTheme(theme);
        renderAll();
      });

      function applyTheme(t) {
        document.getElementById("app").setAttribute("data-theme", t);
        document.getElementById("themeBtn").textContent =
          t === "dark" ? "Light" : "Dark";
      }

      /* =====================
        RENDER: COMMON (dept chips/select)
      ===================== */
      function renderHeaderKPI() {
        document.getElementById("totalPct").textContent = totalProgress() + "%";
      }

      function renderDeptControls() {
        // select
        const sel = document.getElementById("deptSelect");
        const current = viewDept;
        sel.innerHTML = `<option value="ALL">ì „ì²´ Dept</option>`;
        DATA.roadmap.forEach((g) => {
          const opt = document.createElement("option");
          opt.value = g.dept;
          opt.textContent = g.dept;
          sel.appendChild(opt);
        });
        sel.value = current;

        // chips
        const chips = document.getElementById("deptChips");
        chips.innerHTML = "";

        const mk = (label, val, color) => {
          const c = document.createElement("div");
          c.className = "chip " + (viewDept === val ? "on" : "");
          c.textContent = label;
          c.onclick = () => {
            viewDept = val;
            document.getElementById("deptSelect").value = val;
            renderAll();
          };
          if (color) c.style.borderColor = "rgba(255,255,255,0.12)";
          return c;
        };
        chips.appendChild(mk("ì „ì²´", "ALL"));

        DATA.roadmap.forEach((g) => {
          chips.appendChild(mk(g.dept, g.dept, g.color));
        });
      }

      /* =====================
        DASH (cards)
      ===================== */
      function renderDash() {
        const el = document.getElementById("tab-dash");
        const groups = groupFilter();

        const deptCards = DATA.roadmap.map((g) => ({
          dept: g.dept,
          pct: deptProgress(g),
          color: g.color,
          tasks: g.tasks.length,
        }));

        const filteredTasks = groups.flatMap((g) =>
          g.tasks
            .filter((t) => taskPasses(t, g))
            .map((t) => ({
              g,
              t,
              pct: taskProgress(t),
              range: taskDateRange(t),
            })),
        );

        document.getElementById("countBadge").textContent =
          `${filteredTasks.length} tasks`;

        el.innerHTML = `
          <div class="row">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="font-weight:900;font-size:14px">PROGRESS OVERVIEW</div>
              <div class="small">Dept/Task/Step ê°€ì¤‘ì¹˜ ê¸°ë°˜ Â· Task ê¸°ê°„ì€ Step min/max ìë™ ê³„ì‚°</div>
            </div>
            <span class="badge">${viewDept === "ALL" ? "ALL DEPTS" : viewDept}</span>
          </div>

          <div class="hr"></div>

          <div class="cards">
            ${deptCards
              .map(
                (d) => `
              <div class="pCard" style="cursor:pointer" onclick="window.__setDept('${escapeHtml(d.dept)}')">
                <div class="pTop">
                  <div class="pName">${escapeHtml(d.dept)}</div>
                  <div class="pMeta">${d.pct}%<br/><span>${d.tasks} tasks</span></div>
                </div>
                <div class="pBar"><div class="pFill" style="width:${d.pct}%;background:${d.color}"></div></div>
                <div class="pFoot">
                  <span class="pill">SCOPE: ${YEAR}</span>
                  <span class="pill mono">${d.pct}%</span>
                </div>
              </div>
            `,
              )
              .join("")}
          </div>

          <div class="hr"></div>

          <div class="row">
            <div style="font-weight:900">TASK CARDS</div>
            <div class="small">* Task % = ì™„ë£Œëœ Step ê°€ì¤‘ì¹˜ í•© Â· âš  ì—°ë§(12ì›”) ë¯¸ì™„ ìë™ í‘œì‹œ</div>
          </div>

          <div class="hr"></div>

          <div class="cards" style="grid-template-columns:repeat(3,1fr)">
            ${filteredTasks
              .map(({ g, t, pct, range }) => {
                const risk = isYearEndUnfinished(t);
                return `
                  <div class="pCard">
                    <div class="pTop">
                      <div class="pName">
                        <span class="mono" style="color:${g.color}">${escapeHtml(t.id)}</span>
                        Â· ${escapeHtml(t.title)}
                        ${risk ? `<span class="riskBadge" style="margin-left:8px">âš  ì—°ë§ ë¯¸ì™„</span>` : ""}
                      </div>
                      <div class="pMeta">${pct}%</div>
                    </div>
                    <div class="pBar"><div class="pFill" style="width:${pct}%;background:${g.color}"></div></div>
                    <div class="pFoot">
                      <span class="pill">${escapeHtml(g.dept)}</span>
                      <span class="pill mono">${range.start || "â€”"} ~ ${range.end || "â€”"}</span>
                    </div>
                  </div>
                `;
              })
              .join("")}
          </div>
        `;
      }

      window.__setDept = (dept) => {
        viewDept = dept;
        document.getElementById("deptSelect").value = dept;
        renderAll();
      };

      /* =====================
        GANTT (week/month + quarter header)
      ===================== */
      function getWeeksTimeline() {
        const weeks = [];
        MONTHS.forEach((m) => {
          for (let w = 1; w <= 4; w++) weeks.push(`${m} W${w}`);
        });
        return weeks;
      }
      function getMonthsTimeline() {
        return MONTHS.map((m) => `${YEAR}-${pad2(MONTH_MAP[m] + 1)}`);
      }
      function monthLabel(ym) {
        const mm = ym.split("-")[1];
        return mm;
      }

      function renderGantt() {
        const el = document.getElementById("tab-gantt");
        const groups = groupFilter();

        const tasks = groups.flatMap((g) =>
          g.tasks.filter((t) => taskPasses(t, g)).map((t) => ({ g, t })),
        );
        document.getElementById("countBadge").textContent =
          `${tasks.length} tasks`;

        if (ganttMode === "week") {
          const weeks = getWeeksTimeline();

          let html = `
            <div class="row">
              <div style="display:flex;flex-direction:column;gap:6px">
                <div style="font-weight:900;font-size:14px">WEEK GANTT</div>
                <div class="small">ê° ì¹¸ì€ í•´ë‹¹ ì£¼ì— Stepì´ ì¡´ì¬í•˜ë©´ ì±„ì›€(ì™„ë£Œ=100%, ë¯¸ì™„=0%)</div>
              </div>
              <span class="badge">${viewDept === "ALL" ? "ALL" : viewDept} Â· WEEK</span>
            </div>

            <div class="hr"></div>

            <div class="tableWrap">
              <table>
                <thead>
                  <tr>
                    <th style="min-width:90px">Task ID</th>
                    <th style="min-width:520px">Task</th>
                    ${weeks.map((w) => `<th>${w}</th>`).join("")}
                  </tr>
                </thead>
                <tbody>
          `;

          tasks.forEach(({ g, t }) => {
            const pct = taskProgress(t);
            html += `
              <tr>
                <td class="mono" style="color:${g.color};font-weight:900">${escapeHtml(t.id)}</td>
                <td>
                  <div style="display:flex;justify-content:space-between;gap:8px;align-items:flex-start">
                    <div>
                      <div style="font-weight:900">${escapeHtml(t.title)}</div>
                      <div class="small mono">${taskDateRange(t).start || "â€”"} ~ ${taskDateRange(t).end || "â€”"}</div>
                    </div>
                    <span class="badge">${pct}%</span>
                  </div>
                </td>
            `;
            weeks.forEach((w) => {
              const step = t.steps.find((s) => s.week === w);
              if (step) {
                html += `
                  <td class="ganttCell">
                    <div class="gBar" style="width:${step.done ? 100 : 0}%;background:${g.color}"></div>
                  </td>
                `;
              } else {
                html += `<td class="ganttCell"></td>`;
              }
            });
            html += `</tr>`;
          });

          html += `</tbody></table></div>`;
          el.innerHTML = html;
          return;
        }

        const months = getMonthsTimeline();
        const quarters = [
          { q: "Q1", months: months.slice(0, 3) },
          { q: "Q2", months: months.slice(3, 6) },
          { q: "Q3", months: months.slice(6, 9) },
          { q: "Q4", months: months.slice(9, 12) },
        ];

        let html = `
          <div class="row">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="font-weight:900;font-size:14px">MONTH GANTT</div>
              <div class="small">
                ì›” ì¹¸ì€ â€œí•´ë‹¹ ì›”ì— ì†í•œ Step ì¤‘ ì™„ë£Œ ê°€ì¤‘ì¹˜ / ì´ ê°€ì¤‘ì¹˜â€ë¡œ ì±„ì›€(0~100%)
              </div>
            </div>
            <span class="badge">${viewDept === "ALL" ? "ALL" : viewDept} Â· MONTH</span>
          </div>

          <div class="hr"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th rowspan="2" style="min-width:90px">Task ID</th>
                  <th rowspan="2" style="min-width:520px">Task</th>
                  ${quarters.map((q) => `<th colspan="${q.months.length}">${q.q}</th>`).join("")}
                </tr>
                <tr>
                  ${months.map((m) => `<th>${monthLabel(m)}</th>`).join("")}
                </tr>
              </thead>
              <tbody>
        `;

        tasks.forEach(({ g, t }) => {
          const pct = taskProgress(t);
          html += `
            <tr>
              <td class="mono" style="color:${g.color};font-weight:900">${escapeHtml(t.id)}</td>
              <td>
                <div style="display:flex;justify-content:space-between;gap:8px;align-items:flex-start">
                  <div>
                    <div style="font-weight:900">${escapeHtml(t.title)}</div>
                    <div class="small mono">${taskDateRange(t).start || "â€”"} ~ ${taskDateRange(t).end || "â€”"}</div>
                  </div>
                  <span class="badge">${pct}%</span>
                </div>
              </td>
          `;

          months.forEach((ym) => {
            const monthSteps = t.steps.filter(
              (s) => weekToDateRange(s.week).month === ym,
            );
            if (monthSteps.length === 0) {
              html += `<td class="ganttCell"></td>`;
              return;
            }
            normalizeWeights(t);
            const totalW = monthSteps.reduce((a, s) => a + (s.weight || 0), 0);
            const doneW = monthSteps
              .filter((s) => s.done)
              .reduce((a, s) => a + (s.weight || 0), 0);
            const fill = totalW ? Math.round((doneW / totalW) * 100) : 0;
            html += `
              <td class="ganttCell">
                <div class="gBar" style="width:${fill}%;background:${g.color}"></div>
              </td>
            `;
          });

          html += `</tr>`;
        });

        html += `</tbody></table></div>`;
        el.innerHTML = html;
      }

      /* =====================
        WBS (TODO + Outputs + Step ì²´í¬)
        + NEW: 2ì£¼ ë‚´ ë¯¸ì™„ Step highlight(dueSoon/overdue)
      ===================== */
      function renderWBS() {
        const el = document.getElementById("tab-wbs");
        const groups = groupFilter();

        const filtered = groups
          .map((g) => ({
            g,
            tasks: g.tasks.filter((t) => taskPasses(t, g)),
          }))
          .filter((x) => x.tasks.length > 0);

        const totalTasks = filtered.reduce((sum, x) => sum + x.tasks.length, 0);
        document.getElementById("countBadge").textContent =
          `${totalTasks} tasks`;

        let html = `
          <div class="row">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="font-weight:900;font-size:14px">EXECUTION WBS</div>
              <div class="small">
                Step ì²´í¬ ì‹œ ì™„ë£Œì¼(doneAt)ì´ ìë™ ê¸°ë¡ë©ë‹ˆë‹¤.
                Â· <b>OVERDUE(ì§€ì—°)</b>/ <b>DUE â‰¤ 14D(2ì£¼ ë‚´)</b> ë¯¸ì™„ Stepì€ ìë™ í•˜ì´ë¼ì´íŠ¸ë©ë‹ˆë‹¤.
              </div>
            </div>
            <span class="badge">${viewDept === "ALL" ? "ALL" : viewDept} Â· WBS</span>
          </div>

          <div class="hr"></div>
        `;

        filtered.forEach(({ g, tasks }) => {
          html += `
            <div class="row" style="margin-bottom:6px">
              <div style="font-weight:900;color:${g.color}">${escapeHtml(g.dept)}</div>
              <span class="badge">${deptProgress(g)}%</span>
            </div>
          `;

          tasks.forEach((t) => {
            const pct = taskProgress(t);
            const range = taskDateRange(t);
            const risk = isYearEndUnfinished(t);

            html += `
              <div class="taskBlock">
                <div class="taskHead">
                  <div class="taskTitle">
                    <div class="taskLine">
                      <span class="mono" style="color:${g.color}">${escapeHtml(t.id)}</span>
                      Â· ${escapeHtml(t.title)}
                      ${risk ? `<span class="riskBadge" style="margin-left:8px">âš  ì—°ë§ ë¯¸ì™„</span>` : ""}
                    </div>
                    <div class="taskMeta">
                      <span class="tag"><span class="mono">Progress</span> ${pct}%</span>
                      <span class="tag"><span class="mono">ê¸°ê°„</span> ${range.start || "â€”"} ~ ${range.end || "â€”"}</span>
                      <span class="tag"><span class="mono">Steps</span> ${t.steps.filter((s) => s.done).length}/${t.steps.length}</span>
                    </div>
                  </div>

                  <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
                    <div class="pBar" style="width:220px">
                      <div class="pFill" style="width:${pct}%;background:${g.color}"></div>
                    </div>
                    <div class="small">* ê°€ì¤‘ì¹˜(%) ê¸°ë°˜</div>
                  </div>
                </div>

                <div class="cols">
                  <div class="box">
                    <div class="boxTitle">
                      í•´ì•¼ í•  ì¼ (TODO)
                      <span class="badge">${(t.todo || []).length} items</span>
                    </div>
                    <ul class="clean">
                      ${(t.todo || []).map((x) => `<li>${escapeHtml(x)}</li>`).join("")}
                    </ul>
                  </div>

                  <div class="box">
                    <div class="boxTitle">
                      ì‚°ì¶œë¬¼ (Outputs)
                      <span class="badge">${(t.outputs || []).length} files</span>
                    </div>
                    <ul class="clean">
                      ${(t.outputs || []).map((x) => `<li class="mono">${escapeHtml(x)}</li>`).join("")}
                    </ul>
                  </div>
                </div>

                <div class="hr"></div>

                <div class="small" style="font-weight:900;color:var(--text-s);letter-spacing:0.6px">STEPS (ì²´í¬)</div>

                ${(t.steps || [])
                  .map((s, si) => {
                    const r = weekToDateRange(s.week);
                    const out = (s.outputs || [])
                      .map((o) => `<span class="mono">${escapeHtml(o)}</span>`)
                      .join(", ");

                    const ds = stepDueStatus(s);
                    const cls =
                      ds.status === "dueSoon"
                        ? "dueSoon"
                        : ds.status === "overdue"
                          ? "overdue"
                          : "";
                    const tag =
                      ds.status === "dueSoon"
                        ? `<span class="kTag soon">DUE â‰¤ 14D</span>`
                        : ds.status === "overdue"
                          ? `<span class="kTag over">OVERDUE</span>`
                          : ``;

                    return `
                    <div class="stepRow ${cls}">
                      <input type="checkbox" class="cb" ${s.done ? "checked" : ""} onchange="toggleStep('${escapeAttr(g.dept)}','${escapeAttr(t.id)}',${si},this.checked)">
                      <div class="mono">${escapeHtml(s.week)}</div>
                      <div>
                        ${escapeHtml(s.label)}
                        ${tag ? `<span style="margin-left:8px">${tag}</span>` : ``}
                      </div>
                      <div class="mono">${s.weight}%</div>
                      <div class="mono">${s.doneAt || ""}</div>
                      <div class="small">${out ? "ì‚°ì¶œë¬¼: " + out : ""}</div>

                      <div class="small" style="grid-column: 1 / -1">
                        ê¸°ê°„: <span class="mono">${r.start || "â€”"} ~ ${r.end || "â€”"}</span>
                        Â· <span class="mono">${r.year}</span>
                        Â· <span class="mono">${r.quarter}</span>
                        Â· <span class="mono">${r.month}</span>
                      </div>
                    </div>
                  `;
                  })
                  .join("")}
              </div>
            `;
          });
        });

        el.innerHTML = html;
      }

      function toggleStep(deptName, taskId, stepIndex, val) {
        const g = DATA.roadmap.find((x) => x.dept === deptName);
        if (!g) return;
        const t = g.tasks.find((x) => x.id === taskId);
        if (!t) return;
        const step = t.steps[stepIndex];
        if (!step) return;

        step.done = val;
        step.doneAt = val ? fmt(new Date()) : null;

        markDirty();
        renderAll();
      }

      /* =====================
        NEW: OPS ACTION DASHBOARD
        - 1) 2ì£¼ ë‚´ ë¯¸ì™„ Step ìë™ ëª©ë¡
        - 2) Dept ê°„ ì˜ì¡´ì„± ì¶©ëŒ ëª©ë¡
      ===================== */
      function findTaskById(taskId) {
        for (const g of DATA.roadmap) {
          const t = g.tasks.find((x) => x.id === taskId);
          if (t) return { g, t };
        }
        return null;
      }

      function taskHasUpcomingWork(t) {
        // downstream starts within 14d or already started (start <= today+14)
        const today = startOfDay(new Date());
        const limit = startOfDay(addDays(today, OPS_DUE_DAYS));
        return t.steps.some((s) => {
          const r = weekToDateRange(s.week);
          const sd = parseISODate(r.start);
          if (!sd) return false;
          return sd <= limit;
        });
      }

      function buildDueSteps() {
        const groups = groupFilter();
        const items = [];
        groups.forEach((g) => {
          g.tasks
            .filter((t) => taskPasses(t, g))
            .forEach((t) => {
              t.steps.forEach((s, idx) => {
                const ds = stepDueStatus(s);
                if (ds.status === "none") return;
                const r = weekToDateRange(s.week);
                items.push({
                  dept: g.dept,
                  deptColor: g.color,
                  taskId: t.id,
                  taskTitle: t.title,
                  taskPct: taskProgress(t),
                  stepNo: idx + 1,
                  stepWeek: s.week,
                  stepLabel: s.label,
                  stepWeight: s.weight,
                  stepStatus: ds.status,
                  start: r.start,
                  end: r.end,
                  doneAt: s.doneAt || "",
                  outputs: (s.outputs || []).join(" | "),
                });
              });
            });
        });
        // overdue first, then dueSoon; within each sort by end date asc
        const ord = (st) => (st === "overdue" ? 0 : st === "dueSoon" ? 1 : 9);
        items.sort((a, b) => {
          const o = ord(a.stepStatus) - ord(b.stepStatus);
          if (o !== 0) return o;
          if ((a.end || "") < (b.end || "")) return -1;
          if ((a.end || "") > (b.end || "")) return 1;
          return 0;
        });
        return items;
      }

      function buildDependencyConflicts() {
        // conflict definition:
        // - upstream not 100%
        // - downstream has upcoming work (starts within 14d or already started)
        // => risk: downstream blocked / rework ê°€ëŠ¥
        const conflicts = [];
        DEPENDENCIES.forEach((dep) => {
          const up = findTaskById(dep.from);
          const dn = findTaskById(dep.to);
          if (!up || !dn) return;

          const upPct = taskProgress(up.t);
          const dnPct = taskProgress(dn.t);

          if (upPct === 100) return; // no conflict
          if (!taskHasUpcomingWork(dn.t)) return;

          // optional: filter by current dept view (if viewDept != ALL, include conflicts where either side in view dept)
          if (viewDept !== "ALL") {
            const inView = up.g.dept === viewDept || dn.g.dept === viewDept;
            if (!inView) return;
          }

          conflicts.push({
            fromDept: up.g.dept,
            fromColor: up.g.color,
            fromId: up.t.id,
            fromTitle: up.t.title,
            fromPct: upPct,
            fromRange: taskDateRange(up.t),
            toDept: dn.g.dept,
            toColor: dn.g.color,
            toId: dn.t.id,
            toTitle: dn.t.title,
            toPct: dnPct,
            toRange: taskDateRange(dn.t),
            type: dep.type,
            note: dep.note,
          });
        });

        // prioritize by downstream start date (earlier = more urgent)
        conflicts.sort((a, b) =>
          (a.toRange.start || "9999") < (b.toRange.start || "9999") ? -1 : 1,
        );
        return conflicts;
      }

      function renderOps() {
        const el = document.getElementById("tab-ops");
        const due = buildDueSteps();
        const conflicts = buildDependencyConflicts();

        document.getElementById("countBadge").textContent =
          `${due.length} due steps Â· ${conflicts.length} conflicts`;

        const dueRows = due
          .map(
            (d) => `
          <tr>
            <td>${d.stepStatus === "overdue" ? `<span class="kTag over">OVERDUE</span>` : `<span class="kTag soon">DUE â‰¤ 14D</span>`}</td>
            <td>${escapeHtml(d.dept)}</td>
            <td class="mono">${escapeHtml(d.taskId)}</td>
            <td>${escapeHtml(d.taskTitle)}</td>
            <td class="mono">${escapeHtml(d.taskPct)}%</td>
            <td class="mono">${escapeHtml(d.stepWeek)}</td>
            <td>${escapeHtml(d.stepLabel)}</td>
            <td class="mono">${escapeHtml(d.stepWeight)}%</td>
            <td class="mono">${escapeHtml(d.start)}</td>
            <td class="mono">${escapeHtml(d.end)}</td>
            <td class="mono">${escapeHtml(d.doneAt)}</td>
            <td class="mono">${escapeHtml(d.outputs)}</td>
          </tr>
        `,
          )
          .join("");

        const conflictRows = conflicts
          .map(
            (c) => `
          <tr>
            <td><span class="mono">${escapeHtml(c.fromId)}</span> â†’ <span class="mono">${escapeHtml(c.toId)}</span></td>
            <td>${escapeHtml(c.type)}</td>
            <td>
              <div style="font-weight:900;color:${c.fromColor}">${escapeHtml(c.fromDept)}</div>
              <div class="mono">${escapeHtml(c.fromId)} Â· ${escapeHtml(c.fromPct)}%</div>
              <div class="small">${escapeHtml(c.fromTitle)}</div>
              <div class="small mono">${escapeHtml(c.fromRange.start || "â€”")} ~ ${escapeHtml(c.fromRange.end || "â€”")}</div>
            </td>
            <td>
              <div style="font-weight:900;color:${c.toColor}">${escapeHtml(c.toDept)}</div>
              <div class="mono">${escapeHtml(c.toId)} Â· ${escapeHtml(c.toPct)}%</div>
              <div class="small">${escapeHtml(c.toTitle)}</div>
              <div class="small mono">${escapeHtml(c.toRange.start || "â€”")} ~ ${escapeHtml(c.toRange.end || "â€”")}</div>
            </td>
            <td class="small">${escapeHtml(c.note)}</td>
          </tr>
        `,
          )
          .join("");

        el.innerHTML = `
          <div class="row">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="font-weight:900;font-size:14px">ğŸ§  OPS ACTION DASHBOARD</div>
              <div class="small">
                ìš´ì˜íŒ€ ì¦‰ì‹œ ì¡°ì¹˜ìš©:
                (1) <b>2ì£¼ ë‚´ ë§ˆê°(ë˜ëŠ” ì§€ì—°) ë¯¸ì™„ Step</b> ìë™ ëª©ë¡
                (2) <b>Dept ê°„ ì˜ì¡´ì„± ì¶©ëŒ(ì„ í–‰ ë¯¸ì™„ + í›„í–‰ ì„ë°•)</b> ëª©ë¡
              </div>
            </div>
            <span class="badge">${viewDept === "ALL" ? "ALL" : viewDept} Â· ACTION</span>
          </div>

          <div class="hr"></div>

          <div class="row">
            <div style="font-weight:900">1) 2ì£¼ ë‚´ ë¯¸ì™„ Step (ìë™)</div>
            <div class="small">ì •ë ¬: OVERDUE ìš°ì„  â†’ ì¢…ë£Œì¼ ë¹ ë¥¸ ìˆœ</div>
          </div>

          <div class="hr"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>Status</th>
                  <th>Dept</th>
                  <th>TaskID</th>
                  <th>Task</th>
                  <th>Task%</th>
                  <th>Week</th>
                  <th>Step</th>
                  <th>Weight</th>
                  <th>Start</th>
                  <th>End</th>
                  <th>DoneAt</th>
                  <th>StepOutputs</th>
                </tr>
              </thead>
              <tbody>
                ${dueRows || `<tr><td colspan="12" class="small">í‘œì‹œí•  2ì£¼ ë‚´ ë¯¸ì™„(ë˜ëŠ” ì§€ì—°) Stepì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`}
              </tbody>
            </table>
          </div>

          <div class="hr"></div>

          <div class="row">
            <div style="font-weight:900">2) Dept ê°„ ì˜ì¡´ì„± ì¶©ëŒ(ì„ í–‰ ë¯¸ì™„ + í›„í–‰ ì„ë°•)</div>
            <div class="small">
              ê¸°ì¤€: ì„ í–‰ Task ì§„í–‰ë¥  &lt; 100% AND í›„í–‰ Taskê°€ ${OPS_DUE_DAYS}ì¼ ë‚´ ì°©ìˆ˜/ì§„í–‰ ê°€ëŠ¥ êµ¬ê°„ì— ì¡´ì¬
              Â· (ì˜ì¡´ì„± ë§¤í•‘ì€ CONFIGì˜ DEPENDENCIESì—ì„œ ìš´ì˜íŒ€ì´ ìœ ì§€ê´€ë¦¬)
            </div>
          </div>

          <div class="hr"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>Link</th>
                  <th>Type</th>
                  <th>Upstream (ì„ í–‰)</th>
                  <th>Downstream (í›„í–‰)</th>
                  <th>Note</th>
                </tr>
              </thead>
              <tbody>
                ${conflictRows || `<tr><td colspan="5" class="small">í˜„ì¬ ê¸°ì¤€ ì˜ì¡´ì„± ì¶©ëŒì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</td></tr>`}
              </tbody>
            </table>
          </div>
        `;
      }

      /* =====================
        EXPORT (ê¸°ê´€ ì œì¶œìš© Flatten) - ì›ë³¸ ìœ ì§€
      ===================== */
      function buildExportRows() {
        const groups = groupFilter();
        const rows = [];

        groups.forEach((g) => {
          g.tasks
            .filter((t) => taskPasses(t, g))
            .forEach((t) => {
              normalizeWeights(t);
              const taskRange = taskDateRange(t);

              t.steps.forEach((s, idx) => {
                const r = weekToDateRange(s.week);
                rows.push({
                  Dept: g.dept,
                  TaskID: t.id,
                  Task: t.title,

                  TaskStartDate: taskRange.start,
                  TaskEndDate: taskRange.end,
                  TaskProgress: taskProgress(t),

                  Year: r.year,
                  Quarter: r.quarter,
                  Month: r.month,
                  Week: r.week,
                  StartDate: r.start,
                  EndDate: r.end,

                  StepNo: idx + 1,
                  Step: s.label,
                  Weight: s.weight,
                  Status: s.done ? "DONE" : "OPEN",
                  DoneAt: s.doneAt || "",
                  StepOutputs: (s.outputs || []).join(" | "),
                  TaskOutputs: (t.outputs || []).join(" | "),
                  TaskTODO: (t.todo || []).join(" | "),
                });
              });
            });
        });
        return rows;
      }

      function buildCSV(rows) {
        const headers = [
          "Dept",
          "TaskID",
          "Task",
          "TaskStartDate",
          "TaskEndDate",
          "TaskProgress",
          "Year",
          "Quarter",
          "Month",
          "Week",
          "StartDate",
          "EndDate",
          "StepNo",
          "Step",
          "Weight",
          "Status",
          "DoneAt",
          "StepOutputs",
          "TaskOutputs",
          "TaskTODO",
        ];
        const esc = (v) => {
          const s = String(v ?? "");
          if (/[",\n]/.test(s)) return `"${s.replaceAll('"', '""')}"`;
          return s;
        };
        const lines = [];
        lines.push(headers.join(","));
        rows.forEach((r) =>
          lines.push(headers.map((h) => esc(r[h])).join(",")),
        );
        return lines.join("\n");
      }

      function renderExport() {
        const el = document.getElementById("tab-export");
        const rows = buildExportRows();
        document.getElementById("countBadge").textContent =
          `${rows.length} rows`;

        const csv = buildCSV(rows);
        window.__EXPORT_ROWS__ = rows;
        window.__EXPORT_CSV__ = csv;

        el.innerHTML = `
          <div class="row">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="font-weight:900;font-size:14px">ê¸°ê´€ ì œì¶œìš© WBS (Flatten Table)</div>
              <div class="small">Dept/Task/Task ê¸°ê°„ + Year/Quarter/Month/Week ê¸°ê°„ + Step/ì‚°ì¶œë¬¼/ì™„ë£Œì¼ í¬í•¨</div>
            </div>

            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
              <button class="btn primary" onclick="downloadCSV()">CSV ë‹¤ìš´ë¡œë“œ</button>
              <button class="btn" onclick="copyCSV()">CSV ë³µì‚¬</button>
              <span class="badge">${rows.length} rows</span>
            </div>
          </div>

          <div class="hr"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>Dept</th>
                  <th>TaskID</th>
                  <th>Task</th>
                  <th>TaskStart</th>
                  <th>TaskEnd</th>
                  <th>Task%</th>

                  <th>Year</th>
                  <th>Quarter</th>
                  <th>Month</th>
                  <th>Week</th>
                  <th>Start</th>
                  <th>End</th>

                  <th>Step#</th>
                  <th>Step</th>
                  <th>Weight</th>
                  <th>Status</th>
                  <th>DoneAt</th>
                  <th>StepOutputs</th>
                  <th>TaskOutputs</th>
                </tr>
              </thead>
              <tbody>
                ${rows
                  .map(
                    (r) => `
                  <tr>
                    <td>${escapeHtml(r.Dept)}</td>
                    <td class="mono">${escapeHtml(r.TaskID)}</td>
                    <td>${escapeHtml(r.Task)}</td>
                    <td class="mono">${escapeHtml(r.TaskStartDate)}</td>
                    <td class="mono">${escapeHtml(r.TaskEndDate)}</td>
                    <td class="mono">${escapeHtml(r.TaskProgress)}%</td>

                    <td class="mono">${escapeHtml(r.Year)}</td>
                    <td class="mono">${escapeHtml(r.Quarter)}</td>
                    <td class="mono">${escapeHtml(r.Month)}</td>
                    <td class="mono">${escapeHtml(r.Week)}</td>
                    <td class="mono">${escapeHtml(r.StartDate)}</td>
                    <td class="mono">${escapeHtml(r.EndDate)}</td>

                    <td class="mono">${escapeHtml(r.StepNo)}</td>
                    <td>${escapeHtml(r.Step)}</td>
                    <td class="mono">${escapeHtml(r.Weight)}</td>
                    <td>${
                      r.Status === "DONE"
                        ? `<span style="color:var(--done);font-weight:900">DONE</span>`
                        : `<span style="color:var(--text-s);font-weight:900">OPEN</span>`
                    }</td>
                    <td class="mono">${escapeHtml(r.DoneAt)}</td>
                    <td class="mono">${escapeHtml(r.StepOutputs)}</td>
                    <td class="mono">${escapeHtml(r.TaskOutputs)}</td>
                  </tr>
                `,
                  )
                  .join("")}
              </tbody>
            </table>
          </div>

          <div class="hr"></div>
          <div class="small" style="margin-bottom:6px">CSV ë¯¸ë¦¬ë³´ê¸° (ë³µì‚¬/ê²€ì¦ìš©)</div>
          <textarea class="input mono" id="csvPreview" style="width:100%;min-height:160px;resize:vertical"></textarea>
        `;

        el.querySelector("#csvPreview").value = csv;
      }

      function downloadCSV() {
        const csv = window.__EXPORT_CSV__ || "";
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `AITRICS_2026_WBS_${viewDept === "ALL" ? "ALL" : viewDept}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      async function copyCSV() {
        const csv = window.__EXPORT_CSV__ || "";
        try {
          await navigator.clipboard.writeText(csv);
          alert("CSVê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (e) {
          const ta = document.getElementById("csvPreview");
          ta.focus();
          ta.select();
          document.execCommand("copy");
          alert("CSV ë³µì‚¬(í˜¸í™˜ ëª¨ë“œ) ì™„ë£Œ");
        }
      }

      /* =====================
        NEW: GOV TEMPLATE EXPORT
        - ì‹ì•½ì²˜/ì •ë¶€ R&D ì œì¶œ ê´€í–‰ì— ë§ì¶˜ â€œì»¬ëŸ¼ ìˆœì„œ/í•œê¸€ í—¤ë”â€
        - í˜„ì¬ ë°ì´í„°ì—ì„œ ë§¤í•‘ ê°€ëŠ¥í•œ ê°’ë§Œ ì±„ìš°ê³ , ë‚˜ë¨¸ì§€ëŠ” ê³µë€(ë‹´ë‹¹ì/MM/ì„±ê³¼ì§€í‘œ ë“±)
      ===================== */
      function buildGovTemplateRows() {
        const groups = groupFilter();
        const rows = [];
        groups.forEach((g) => {
          g.tasks
            .filter((t) => taskPasses(t, g))
            .forEach((t) => {
              normalizeWeights(t);
              const tr = taskDateRange(t);
              t.steps.forEach((s, idx) => {
                const r = weekToDateRange(s.week);
                const ds = stepDueStatus(s);
                rows.push({
                  ê³¼ì œì—°ë„: YEAR,
                  "ë¶„ì•¼(ë¶€ì„œ)": g.dept,
                  "WBS(Task)ID": t.id,
                  "ì„¸ë¶€ì—…ë¬´(Taskëª…)": t.title,
                  "ë‹¨ê³„(Step#)": idx + 1,
                  "ì„¸ë¶€í™œë™(Step)": s.label,
                  ê¸°ê°„_ì‹œì‘: r.start,
                  ê¸°ê°„_ì¢…ë£Œ: r.end,
                  "ê°€ì¤‘ì¹˜(%)": s.weight,
                  ì§„í–‰ìƒíƒœ: s.done ? "ì™„ë£Œ" : "ë¯¸ì™„",
                  "ì™„ë£Œì¼(DoneAt)": s.doneAt || "",
                  "ë¦¬ìŠ¤í¬(2ì£¼/ì§€ì—°)":
                    ds.status === "overdue"
                      ? "ì§€ì—°(OVERDUE)"
                      : ds.status === "dueSoon"
                        ? "2ì£¼ë‚´(DUEâ‰¤14D)"
                        : "",
                  "ì£¼ìš”ì‚°ì¶œë¬¼(í•´ë‹¹Step)": (s.outputs || []).join(" | "),
                  "ì‚°ì¶œë¬¼(ì „ì²´Task)": (t.outputs || []).join(" | "),
                  "ì£¼ìš”ìˆ˜í–‰ë‚´ìš©(TODO)": (t.todo || []).join(" | "),
                  "ì„±ê³¼ì§€í‘œ(KPI)": "", // ê¸°ê´€ ì œì¶œìš©: ì¶”í›„ ê¸°ì…
                  ë‹´ë‹¹ì: "", // ê¸°ê´€ ì œì¶œìš©: ì¶”í›„ ê¸°ì…
                  "íˆ¬ì…ì¸ë ¥(M/M)": "", // ê¸°ê´€ ì œì¶œìš©: ì¶”í›„ ê¸°ì…
                  ë¹„ê³ : "", // ê¸°ê´€ ì œì¶œìš©: ì¶”í›„ ê¸°ì…
                });
              });
            });
        });
        return rows;
      }

      function buildGovCSV(rows) {
        const headers = [
          "ê³¼ì œì—°ë„",
          "ë¶„ì•¼(ë¶€ì„œ)",
          "WBS(Task)ID",
          "ì„¸ë¶€ì—…ë¬´(Taskëª…)",
          "ë‹¨ê³„(Step#)",
          "ì„¸ë¶€í™œë™(Step)",
          "ê¸°ê°„_ì‹œì‘",
          "ê¸°ê°„_ì¢…ë£Œ",
          "ê°€ì¤‘ì¹˜(%)",
          "ì§„í–‰ìƒíƒœ",
          "ì™„ë£Œì¼(DoneAt)",
          "ë¦¬ìŠ¤í¬(2ì£¼/ì§€ì—°)",
          "ì£¼ìš”ì‚°ì¶œë¬¼(í•´ë‹¹Step)",
          "ì‚°ì¶œë¬¼(ì „ì²´Task)",
          "ì£¼ìš”ìˆ˜í–‰ë‚´ìš©(TODO)",
          "ì„±ê³¼ì§€í‘œ(KPI)",
          "ë‹´ë‹¹ì",
          "íˆ¬ì…ì¸ë ¥(M/M)",
          "ë¹„ê³ ",
        ];
        const esc = (v) => {
          const s = String(v ?? "");
          if (/[",\n]/.test(s)) return `"${s.replaceAll('"', '""')}"`;
          return s;
        };
        const lines = [];
        lines.push(headers.join(","));
        rows.forEach((r) =>
          lines.push(headers.map((h) => esc(r[h])).join(",")),
        );
        return lines.join("\n");
      }

      function renderTemplate() {
        const el = document.getElementById("tab-template");
        const rows = buildGovTemplateRows();
        const csv = buildGovCSV(rows);
        window.__GOV_ROWS__ = rows;
        window.__GOV_CSV__ = csv;

        document.getElementById("countBadge").textContent =
          `${rows.length} rows`;

        el.innerHTML = `
          <div class="row">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="font-weight:900;font-size:14px">ğŸ›ï¸ ê¸°ê´€ ì œì¶œìš© WBS í…œí”Œë¦¿ (MFDS/ì •ë¶€ R&amp;D ì»¬ëŸ¼ ì •ë ¬)</div>
              <div class="small">
                ëª©ì : ê¸°ê´€ ì œì¶œ ê´€í–‰ì— ë§ê²Œ <b>í•œê¸€ í—¤ë”/ì»¬ëŸ¼ ìˆœì„œ</b>ë¡œ Export.
                Â· í˜„ì¬ ë°ì´í„°ë¡œ ë§¤í•‘ ê°€ëŠ¥í•œ ê°’ì€ ìë™ ì±„ì›€
                Â· <span class="mono">ì„±ê³¼ì§€í‘œ(KPI)/ë‹´ë‹¹ì/íˆ¬ì…(MM)/ë¹„ê³ </span>ëŠ” ê³µë€ìœ¼ë¡œ ë‘ê³  ê¸°ê´€ ì–‘ì‹ì— ë§ì¶° ê¸°ì…
              </div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
              <button class="btn primary" onclick="downloadGovCSV()">CSV ë‹¤ìš´ë¡œë“œ</button>
              <button class="btn" onclick="copyGovCSV()">CSV ë³µì‚¬</button>
              <span class="badge">${rows.length} rows</span>
            </div>
          </div>

          <div class="hr"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>ê³¼ì œì—°ë„</th>
                  <th>ë¶„ì•¼(ë¶€ì„œ)</th>
                  <th>WBS(Task)ID</th>
                  <th>ì„¸ë¶€ì—…ë¬´(Taskëª…)</th>
                  <th>ë‹¨ê³„</th>
                  <th>ì„¸ë¶€í™œë™(Step)</th>
                  <th>ê¸°ê°„_ì‹œì‘</th>
                  <th>ê¸°ê°„_ì¢…ë£Œ</th>
                  <th>ê°€ì¤‘ì¹˜</th>
                  <th>ì§„í–‰ìƒíƒœ</th>
                  <th>ì™„ë£Œì¼</th>
                  <th>ë¦¬ìŠ¤í¬</th>
                  <th>ì£¼ìš”ì‚°ì¶œë¬¼(í•´ë‹¹Step)</th>
                  <th>ì‚°ì¶œë¬¼(ì „ì²´Task)</th>
                </tr>
              </thead>
              <tbody>
                ${rows
                  .map(
                    (r) => `
                  <tr>
                    <td class="mono">${escapeHtml(r["ê³¼ì œì—°ë„"])}</td>
                    <td>${escapeHtml(r["ë¶„ì•¼(ë¶€ì„œ)"])}</td>
                    <td class="mono">${escapeHtml(r["WBS(Task)ID"])}</td>
                    <td>${escapeHtml(r["ì„¸ë¶€ì—…ë¬´(Taskëª…)"])}</td>
                    <td class="mono">${escapeHtml(r["ë‹¨ê³„(Step#)"])}</td>
                    <td>${escapeHtml(r["ì„¸ë¶€í™œë™(Step)"])}</td>
                    <td class="mono">${escapeHtml(r["ê¸°ê°„_ì‹œì‘"])}</td>
                    <td class="mono">${escapeHtml(r["ê¸°ê°„_ì¢…ë£Œ"])}</td>
                    <td class="mono">${escapeHtml(r["ê°€ì¤‘ì¹˜(%)"])}%</td>
                    <td>${escapeHtml(r["ì§„í–‰ìƒíƒœ"])}</td>
                    <td class="mono">${escapeHtml(r["ì™„ë£Œì¼(DoneAt)"])}</td>
                    <td>${escapeHtml(r["ë¦¬ìŠ¤í¬(2ì£¼/ì§€ì—°)"])}</td>
                    <td class="mono">${escapeHtml(r["ì£¼ìš”ì‚°ì¶œë¬¼(í•´ë‹¹Step)"])}</td>
                    <td class="mono">${escapeHtml(r["ì‚°ì¶œë¬¼(ì „ì²´Task)"])}</td>
                  </tr>
                `,
                  )
                  .join("")}
              </tbody>
            </table>
          </div>

          <div class="hr"></div>
          <div class="small" style="margin-bottom:6px">CSV ë¯¸ë¦¬ë³´ê¸° (ë³µì‚¬/ê²€ì¦ìš©)</div>
          <textarea class="input mono" id="govCsvPreview" style="width:100%;min-height:180px;resize:vertical"></textarea>
        `;

        el.querySelector("#govCsvPreview").value = csv;
      }

      function downloadGovCSV() {
        const csv = window.__GOV_CSV__ || "";
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `AITRICS_2026_GOV_TEMPLATE_${viewDept === "ALL" ? "ALL" : viewDept}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      async function copyGovCSV() {
        const csv = window.__GOV_CSV__ || "";
        try {
          await navigator.clipboard.writeText(csv);
          alert("ê¸°ê´€ ì œì¶œ í…œí”Œë¦¿ CSVê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (e) {
          const ta = document.getElementById("govCsvPreview");
          ta.focus();
          ta.select();
          document.execCommand("copy");
          alert("CSV ë³µì‚¬(í˜¸í™˜ ëª¨ë“œ) ì™„ë£Œ");
        }
      }

      /* =====================
        ESCAPE
      ===================== */
      function escapeHtml(s) {
        return String(s ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }
      function escapeAttr(s) {
        return String(s ?? "")
          .replaceAll("'", "&#039;")
          .replaceAll('"', "&quot;");
      }

      /* =====================
        RENDER ALL
      ===================== */
      function renderAll() {
        renderHeaderKPI();
        renderDeptControls();

        document.getElementById("tab-dash").style.display =
          activeTab === "dash" ? "block" : "none";
        document.getElementById("tab-gantt").style.display =
          activeTab === "gantt" ? "block" : "none";
        document.getElementById("tab-wbs").style.display =
          activeTab === "wbs" ? "block" : "none";
        document.getElementById("tab-ops").style.display =
          activeTab === "ops" ? "block" : "none";
        document.getElementById("tab-export").style.display =
          activeTab === "export" ? "block" : "none";
        document.getElementById("tab-template").style.display =
          activeTab === "template" ? "block" : "none";

        if (activeTab === "dash") renderDash();
        if (activeTab === "gantt") renderGantt();
        if (activeTab === "wbs") renderWBS();
        if (activeTab === "ops") renderOps();
        if (activeTab === "export") renderExport();
        if (activeTab === "template") renderTemplate();
      }

      /* =====================
        BOOT
      ===================== */
      markDirty("NOT SAVED");
      renderAll();
    </script>
  </body>
</html>
